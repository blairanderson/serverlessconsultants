<!DOCTYPE html> <html> <head> <script type="text/javascript"> var host = 'www.serverlessconsultants.com'; if (host == window.location.host && window.location.protocol != 'https:') { window.location.protocol = 'https'; } </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content="Serverless Directory"> <meta name="msvalidate.01" content="0C81C6A5BD3BAF86F4730D8C4A9BF223" /> <meta name="google-site-verification" content=""> <title>Serverless Plugin Multiple Responses - Serverless Plugin Directory</title> <!-- Google+ Authorship --> <link rel="author" href="Serverless Directory"> <link rel="publisher" href="Serverless Directory"> <!-- Canonical --> <link rel="canonical" href="https://www.serverlessconsultants.com/plugins/serverless-plugin-multiple-responses/"> <!-- Fonts --> <link href='https://fonts.googleapis.com/css?family=Libre+Franklin:400,100,100italic,200,200italic,300,300italic,400italic,500,600,500italic,600italic,700,700italic,800,900,800italic,900italic' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'> <!-- Styles --> <link rel="stylesheet" href=" /css/main.css "> <!-- Feed --> <link rel="alternate" type="application/rss+xml" title="ServerLess Directory" href="https://www.serverlessconsultants.com /feed.xml "> <!-- Fav Icon and Apple Touch Icons --> <link rel="icon" type="image/png" href="/img/favicon.png" sizes="128x128" /> <meta name="application-name" content="ServerLess Directory" /> <!-- Open Graph --> <meta property="og:title" content="Serverless Plugin Multiple Responses - Serverless Plugin Directory"> <meta property="og:site_name" content="ServerLess Directory"> <meta property="og:type" content="website"> <meta property="og:description" content="Open Issue Count: 1, Stargazer Count: 13, Forks Count: 2, Watchers Count: 13."> </head> <script type="text/javascript"> (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]); a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga('create', 'UA-61052500-12', 'auto'); ga('send', 'pageview'); </script> <body> <!-- Navigation --> <header class="bg-white w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-999 bb b--light-gray"> <nav class="tc"> <a class="dib no-underline v-mid tc bw1 ba b gold ph1 pv2 outline b--gold" href="/" rel="nofollow"> <div>SRVR</div> <div>LSS</div> </a> <a class="link dim black b f6 f5-ns dib mr3" href="/" title="Serverless Directory">Serverless Directory</a> <a class="link dim gray f6 f5-ns dib mr3" href="/plugins/">Serverless Plugins</a> <a class="link dim gray f6 f5-ns dib mr3" href="/frameworks/">Serverless Frameworks</a> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/consultants/">Serverless Consultants</a> --> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/contact" title="Contact Serverless Frameworks Directory">Contact</a> --> </nav> </header> <div class="mw8 center"> <h1 class="tc ma0">Serverless Plugin Multiple Responses</h1> <div class="tc"> <a rel="nofollow noreferrer noopener" href="https://github.com/silvermine/serverless-plugin-multiple-responses"> <img src="https://icon.now.sh/home" alt="homepage icon"> https://github.com/silvermine/serverless-plugin-multiple-responses </a> </div> <article class="ph3 ph5-ns"> <h3 class="f6 ma0 pa0 ttu tc tracked">Tracked</h3> <div class="cf tc"> <dl title="NPM Downloads Last Month: 37" class="db tc mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">NPM Downloads Last Month</dd> <dd class="f3 fw6 ml0">37</dd> </dl> <dl title="Open Issue Count: 1" class="fl fn-l w-50 mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Issues</dd> <dd class="f3 fw6 ml0">1</dd> </dl> <dl title="Stargazer Count: 13" class="fl fn-l w-50 dib-l mb0 w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Stars</dd> <dd class="f3 fw6 ml0">13</dd> </dl> <dl title="Forks Count: 2" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title mr5-l"> <dd class="f6 fw4 ml0">Forks</dd> <dd class="f3 fw6 ml0">2</dd> </dl> <dl title="Watchers Count: 13" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title"> <dd class="f6 fw4 ml0">Watchers</dd> <dd class="f3 fw6 ml0">13</dd> </dl> </div> </article> <!-- TODO: FIX THIS --> <div class="cf tc mw6 center dn"> </div> </div> <h3 class="tc">Repo README Contents:</h3> <section class="mw8 center ph3 pv2 overflow-x-scroll ba br3" id="readme-content"> <h1 id="serverless-plugin-multiple-responses">Serverless Plugin: Multiple Responses</h1> <p><a href="https://travis-ci.org/silvermine/serverless-plugin-multiple-responses"><img src="https://travis-ci.org/silvermine/serverless-plugin-multiple-responses.png?branch=master" alt="Build Status" /></a> <a href="https://coveralls.io/github/silvermine/serverless-plugin-multiple-responses?branch=master"><img src="https://coveralls.io/repos/github/silvermine/serverless-plugin-multiple-responses/badge.svg?branch=master" alt="Coverage Status" /></a> <a href="https://david-dm.org/silvermine/serverless-plugin-multiple-responses"><img src="https://david-dm.org/silvermine/serverless-plugin-multiple-responses.png" alt="Dependency Status" /></a> <a href="https://david-dm.org/silvermine/serverless-plugin-multiple-responses#info=devDependencies&amp;view=table"><img src="https://david-dm.org/silvermine/serverless-plugin-multiple-responses/dev-status.png" alt="Dev Dependency Status" /></a></p> <h2 id="what-is-it">What is it?</h2> <p><strong>This plugin is now deprecated and no longer supported.</strong> It was originally a plugin for the early versions of the Serverless framework intended to address the issues outlined at https://github.com/serverless/serverless/issues/2046 (and in my - jthomerson - comments there).</p> <p><strong>Since you can now use the API Gateway proxy integration and have full control over response headers and status codes, you should no longer need this plugin. See https://github.com/serverless/serverless/issues/2174 for more information.</strong></p> <h2 id="how-do-i-use-it">How do I use it?</h2> <p>The basic principle is that instead of adding a <code class="highlighter-rouge">response</code> attribute to your HTTP event config, you will add a <code class="highlighter-rouge">responses</code> attribute.</p> <p>The responses attribute is a key/value pair where the key is the status code of the response (e.g. 200, 404, etc). The value can be:</p> <ul> <li><code class="highlighter-rouge">false</code> - which means “remove the default response configured by SLS (or another plugin) for this response code”</li> <li>an object with the following attributes: <ul> <li><code class="highlighter-rouge">headers</code> - just the same as the SLS <code class="highlighter-rouge">headers</code> attribute</li> <li><code class="highlighter-rouge">templates</code> - similar to request templates, this is keyed by the response content type</li> <li><code class="highlighter-rouge">properties</code> - any other properties to directly add to the CloudFormation template for this API method <ul> <li>typically this is used to add <code class="highlighter-rouge">SelectionPattern</code> for the error responses</li> </ul> </li> </ul> </li> </ul> <p>NOTE: leaving one response without a selection pattern attribute makes it the default response.</p> <p>Below we will show two examples: a standard example where 200 is what your function returns for a successful completion, and another example where it needs to return a 302 as its default (non-error) response. The 302 response example would be used if your were building a bit.ly-like endpoint, for example.</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="c1"># I recommend using variables to define your responses since they tend</span>
<span class="c1"># to be the same across all of your API gateway functions, but you</span>
<span class="c1"># certainly don't have to.</span>
<span class="s">custom</span><span class="pi">:</span>
   <span class="s">defaultRegion</span><span class="pi">:</span> <span class="s">us-east-1</span>
   <span class="s">region</span><span class="pi">:</span> <span class="s">${opt:region, self:custom.defaultRegion}</span>
   <span class="s">stage</span><span class="pi">:</span> <span class="s">${opt:stage, env:USER}</span>
   <span class="s">standardRequest</span><span class="pi">:</span>
      <span class="s">template</span><span class="pi">:</span>
         <span class="s">application/json</span><span class="pi">:</span> <span class="s">${file(templates/standard-request.tpl)}</span>
   <span class="s">standardResponseHeaders</span><span class="pi">:</span>
      <span class="s1">'</span><span class="s">Access-Control-Allow-Origin'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">'*'"</span>
      <span class="s1">'</span><span class="s">Content-Type'</span><span class="pi">:</span> <span class="s1">'</span><span class="s">integration.response.body.headers.Content-Type'</span>
      <span class="s1">'</span><span class="s">Expires'</span><span class="pi">:</span> <span class="s1">'</span><span class="s">integration.response.body.headers.Expires'</span>
      <span class="s1">'</span><span class="s">Cache-Control'</span><span class="pi">:</span> <span class="s1">'</span><span class="s">integration.response.body.headers.Cache-Control'</span>
      <span class="s1">'</span><span class="s">Pragma'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">'no-cache'"</span>
   <span class="s">standardResponseTemplate</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$input.path('$.body')"</span>
   <span class="s">errorResponseHeaders</span><span class="pi">:</span>
      <span class="s1">'</span><span class="s">Access-Control-Allow-Origin'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">'*'"</span>
      <span class="s1">'</span><span class="s">Expires'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">'Thu,</span><span class="nv"> </span><span class="s">19</span><span class="nv"> </span><span class="s">Nov</span><span class="nv"> </span><span class="s">1981</span><span class="nv"> </span><span class="s">08:52:00</span><span class="nv"> </span><span class="s">GMT'"</span>
      <span class="s1">'</span><span class="s">Cache-Control'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">'no-cache,</span><span class="nv"> </span><span class="s">max-age=0,</span><span class="nv"> </span><span class="s">must-revalidate'"</span>
      <span class="s1">'</span><span class="s">Pragma'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">'no-cache'"</span>
   <span class="s">errorResponseTemplate</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$input.path('$.errorMessage')"</span>
   <span class="c1"># Here we are defining what would be under "responses" in your HTTP event</span>
   <span class="c1"># if you were not using the custom variables.</span>
   <span class="s">standardResponses</span><span class="pi">:</span>
      <span class="s">200</span><span class="pi">:</span>
         <span class="s">headers</span><span class="pi">:</span> <span class="s">${self:custom.standardResponseHeaders}</span>
         <span class="s">templates</span><span class="pi">:</span>
            <span class="s1">'</span><span class="s">application/json;charset=UTF-8'</span><span class="pi">:</span> <span class="s">${self:custom.standardResponseTemplate}</span>
      <span class="s">404</span><span class="pi">:</span>
         <span class="s">headers</span><span class="pi">:</span> <span class="s">${self:custom.errorResponseHeaders}</span>
         <span class="s">templates</span><span class="pi">:</span>
            <span class="s1">'</span><span class="s">application/json;charset=UTF-8'</span><span class="pi">:</span> <span class="s">${self:custom.errorResponseTemplate}</span>
         <span class="s">properties</span><span class="pi">:</span>
            <span class="s">SelectionPattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">.*\"status\":404.*'</span>
      <span class="s">500</span><span class="pi">:</span>
         <span class="s">headers</span><span class="pi">:</span> <span class="s">${self:custom.errorResponseHeaders}</span>
         <span class="s">templates</span><span class="pi">:</span>
            <span class="s1">'</span><span class="s">application/json;charset=UTF-8'</span><span class="pi">:</span> <span class="s">${self:custom.errorResponseTemplate}</span>
         <span class="s">properties</span><span class="pi">:</span>
            <span class="s">SelectionPattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">.*\"status\":500.*'</span>
   <span class="s">redirectResponses</span><span class="pi">:</span>
      <span class="c1"># Since we want to return 302 upon a successful completion, we remove the</span>
      <span class="c1"># built-in default of 200</span>
      <span class="s">200</span><span class="pi">:</span> <span class="s">false</span>
      <span class="s">302</span><span class="pi">:</span>
         <span class="s">headers</span><span class="pi">:</span>
            <span class="s">Location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">integration.response.body.headers.Location"</span>
         <span class="s">templates</span><span class="pi">:</span>
            <span class="s1">'</span><span class="s">application/json;charset=UTF-8'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$input.path('$.body')"</span>
            <span class="s1">'</span><span class="s">text/html;charset=UTF-8'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$input.path('$.body')"</span>
      <span class="s">404</span><span class="pi">:</span>
         <span class="s">headers</span><span class="pi">:</span> <span class="s">${self:custom.errorResponseHeaders}</span>
         <span class="s">templates</span><span class="pi">:</span>
            <span class="s1">'</span><span class="s">application/json;charset=UTF-8'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$input.path('$.body')"</span>
            <span class="s1">'</span><span class="s">text/html;charset=UTF-8'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$input.path('$.body')"</span>
         <span class="s">properties</span><span class="pi">:</span>
            <span class="s">SelectionPattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">.*\"status\":404.*'</span>
      <span class="s">500</span><span class="pi">:</span>
         <span class="s">headers</span><span class="pi">:</span> <span class="s">${self:custom.errorResponseHeaders}</span>
         <span class="s">templates</span><span class="pi">:</span>
            <span class="s1">'</span><span class="s">application/json;charset=UTF-8'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$input.path('$.body')"</span>
            <span class="s1">'</span><span class="s">text/html;charset=UTF-8'</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$input.path('$.body')"</span>
         <span class="s">properties</span><span class="pi">:</span>
            <span class="s">SelectionPattern</span><span class="pi">:</span> <span class="s1">'</span><span class="s">.*\"status\":500.*'</span>

<span class="c1"># Tell your service that you want to use this plugin:</span>
<span class="c1"># (you'll need to `npm install` it first)</span>
<span class="s">plugins</span><span class="pi">:</span>
   <span class="pi">-</span> <span class="s">serverless-plugin-multiple-responses</span>

<span class="c1"># In the function's http event configuration you see where</span>
<span class="c1"># we have `responses` instead of the normal `response`.</span>
<span class="s">functions</span><span class="pi">:</span>
   <span class="s">ping</span><span class="pi">:</span>
      <span class="s">name</span><span class="pi">:</span> <span class="s">${self:service}-${self:provider.stage}-ping</span>
      <span class="s">handler</span><span class="pi">:</span> <span class="s">src/ping/Ping.handler</span>
      <span class="s">memorySize</span><span class="pi">:</span> <span class="s">128</span>
      <span class="s">timeout</span><span class="pi">:</span> <span class="s">2</span>
      <span class="s">events</span><span class="pi">:</span>
         <span class="pi">-</span> <span class="s">http</span><span class="pi">:</span>
            <span class="s">method</span><span class="pi">:</span> <span class="s">GET</span>
            <span class="s">path</span><span class="pi">:</span> <span class="s">ping</span>
            <span class="s">request</span><span class="pi">:</span> <span class="s">${self:custom.standardRequest}</span>
            <span class="s">responses</span><span class="pi">:</span> <span class="s">${self:custom.standardResponses}</span>
   <span class="s">redirector</span><span class="pi">:</span>
      <span class="s">name</span><span class="pi">:</span> <span class="s">${self:service}-${self:provider.stage}-redirector</span>
      <span class="s">handler</span><span class="pi">:</span> <span class="s">src/redirector/Redirector.handler</span>
      <span class="s">memorySize</span><span class="pi">:</span> <span class="s">128</span>
      <span class="s">timeout</span><span class="pi">:</span> <span class="s">2</span>
      <span class="s">events</span><span class="pi">:</span>
         <span class="pi">-</span> <span class="s">http</span><span class="pi">:</span>
            <span class="s">method</span><span class="pi">:</span> <span class="s">GET</span>
            <span class="s">path</span><span class="pi">:</span> <span class="s">redirector</span>
            <span class="s">request</span><span class="pi">:</span> <span class="s">${self:custom.standardRequest}</span>
            <span class="s">responses</span><span class="pi">:</span> <span class="s">${self:custom.redirectResponses}</span>
</code></pre></div> <h2 id="how-do-i-contribute">How do I contribute?</h2> <p>Easy! Pull requests are welcome! Just do the following:</p> <ul> <li>Clone the code</li> <li>Install the dependencies with <code class="highlighter-rouge">npm install</code></li> <li>Create a feature branch (e.g. <code class="highlighter-rouge">git checkout -b my_new_feature</code>)</li> <li>Make your changes and commit them with a reasonable commit message</li> <li>Make sure the code passes our standards with <code class="highlighter-rouge">grunt standards</code></li> <li>Make sure all unit tests pass with <code class="highlighter-rouge">npm test</code></li> </ul> <p>Our goal is 100% unit test coverage, with <strong>good and effective</strong> tests (it’s easy to hit 100% coverage with junk tests, so we differentiate). We <strong>will not accept pull requests for new features that do not include unit tests</strong>. If you are submitting a pull request to fix a bug, we may accept it without unit tests (we will certainly write our own for that bug), but we <em>strongly encourage</em> you to write a unit test exhibiting the bug, commit that, and then commit a fix in a separate commit. This <em>greatly increases</em> the likelihood that we will accept your pull request and the speed with which we can process it.</p> <h2 id="license">License</h2> <p>This software is released under the MIT license. See <a href="LICENSE">the license file</a> for more details.</p> </section> <footer class="cf w-100"> <div class="cover bg-left bg-center-l pv5" style="background-image: url(/img/bg.png)"> <form action="//tachyonstemplates.us16.list-manage.com/subscribe/post?u=3ff847fac68c99ba4cbf378be&amp;id=8eb026def6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="center pa3" target="_blank" novalidate> <div> <h3 class="pa0 f3 f2-ns mb3 mt0 white tc">Want more Serverless?</h3> <h5 class="pa0 f4 f3-ns mb3 white tc">Subscribe to our mailing list to receive an update when new items arrive!</h5> <div class="cf mw7 center"> <label class="clip" for="email-address">Email Address</label> <input placeholder="Your Email Address" type="email" name="EMAIL" class="f6 f5-l input-reset bn fl black-80 bg-white pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns"> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3ff847fac68c99ba4cbf378be_8eb026def6" tabindex="-1" value=""></div> <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-black-70 hover-bg-black white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" name="subscribe" type="submit" value="Subscribe"> </div> </div> </form> </div> <div class="pb4 pt2 ph3 ph5-ns tc lh-copy"> <a class="pv2 db ph3 dim" href="/">Serverless Directory - Plugins, Frameworks, Consultants</a> <a class="pv2 db ph3 dim" href="/frameworks/">Serverless Frameworks Directory</a> <a class="pv2 db ph3 dim" href="/plugins/">Serverless Plugin Directory</a> <a class="pv2 db ph3 dim" href="/plugins/topics/">Serverless Plugin Topics</a> </div> </footer> <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script> <!-- keeping this here for prosperity --> </body> </html>
