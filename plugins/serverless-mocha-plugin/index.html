<!DOCTYPE html> <html> <head> <script type="text/javascript"> var host = 'www.serverlessconsultants.com'; if (host == window.location.host && window.location.protocol != 'https:') { window.location.protocol = 'https'; } </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content="Serverless Directory"> <meta name="msvalidate.01" content="0C81C6A5BD3BAF86F4730D8C4A9BF223" /> <meta name="google-site-verification" content=""> <title>Serverless Mocha Plugin - Serverless Plugin Directory</title> <!-- Google+ Authorship --> <link rel="author" href="Serverless Directory"> <link rel="publisher" href="Serverless Directory"> <!-- Canonical --> <link rel="canonical" href="https://www.serverlessconsultants.com/plugins/serverless-mocha-plugin/"> <!-- Fonts --> <link href='https://fonts.googleapis.com/css?family=Libre+Franklin:400,100,100italic,200,200italic,300,300italic,400italic,500,600,500italic,600italic,700,700italic,800,900,800italic,900italic' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'> <!-- Styles --> <link rel="stylesheet" href=" /css/main.css "> <!-- Feed --> <link rel="alternate" type="application/rss+xml" title="ServerLess Directory" href="https://www.serverlessconsultants.com /feed.xml "> <!-- Fav Icon and Apple Touch Icons --> <link rel="icon" type="image/png" href="/img/favicon.png" sizes="128x128" /> <meta name="application-name" content="ServerLess Directory" /> <!-- Open Graph --> <meta property="og:title" content="Serverless Mocha Plugin - Serverless Plugin Directory"> <meta property="og:site_name" content="ServerLess Directory"> <meta property="og:type" content="website"> <meta property="og:description" content="Open Issue Count: 10, Stargazer Count: 68, Forks Count: 30, Watchers Count: 68."> </head> <script type="text/javascript"> (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]); a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga('create', 'UA-61052500-12', 'auto'); ga('send', 'pageview'); </script> <body> <!-- Navigation --> <header class="bg-white w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-999 bb b--light-gray"> <nav class="tc"> <a class="dib no-underline v-mid tc bw1 ba b gold ph1 pv2 outline b--gold" href="/" rel="nofollow"> <div>SRVR</div> <div>LSS</div> </a> <a class="link dim black b f6 f5-ns dib mr3" href="/" title="Serverless Directory">Serverless Directory</a> <a class="link dim gray f6 f5-ns dib mr3" href="/plugins/">Serverless Plugins</a> <a class="link dim gray f6 f5-ns dib mr3" href="/frameworks/">Serverless Frameworks</a> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/consultants/">Serverless Consultants</a> --> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/contact" title="Contact Serverless Frameworks Directory">Contact</a> --> </nav> </header> <div class="mw8 center"> <h1 class="tc ma0">Serverless Mocha Plugin</h1> <div class="tc"> <a rel="nofollow noreferrer noopener" href="https://github.com/SC5/serverless-mocha-plugin"> <img src="https://icon.now.sh/home" alt="homepage icon"> https://github.com/SC5/serverless-mocha-plugin </a> </div> <article class="ph3 ph5-ns"> <h3 class="f6 ma0 pa0 ttu tc tracked">Tracked</h3> <div class="cf tc"> <dl title="NPM Downloads Last Month: 3678" class="db tc mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">NPM Downloads Last Month</dd> <dd class="f3 fw6 ml0">3678</dd> </dl> <dl title="Open Issue Count: 10" class="fl fn-l w-50 mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Issues</dd> <dd class="f3 fw6 ml0">10</dd> </dl> <dl title="Stargazer Count: 68" class="fl fn-l w-50 dib-l mb0 w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Stars</dd> <dd class="f3 fw6 ml0">68</dd> </dl> <dl title="Forks Count: 30" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title mr5-l"> <dd class="f6 fw4 ml0">Forks</dd> <dd class="f3 fw6 ml0">30</dd> </dl> <dl title="Watchers Count: 68" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title"> <dd class="f6 fw4 ml0">Watchers</dd> <dd class="f3 fw6 ml0">68</dd> </dl> </div> </article> <!-- TODO: FIX THIS --> <div class="cf tc mw6 center dn"> </div> </div> <h3 class="tc">Repo README Contents:</h3> <section class="mw8 center ph3 pv2 overflow-x-scroll ba br3" id="readme-content"> <h1 id="serverless-mocha-plugin">Serverless Mocha Plugin</h1> <p><a href="https://travis-ci.org/SC5/serverless-mocha-plugin"><img src="https://travis-ci.org/SC5/serverless-mocha-plugin.svg?branch=master" alt="Build Status" /></a></p> <p>A Serverless Plugin for the <a href="http://www.serverless.com">Serverless Framework</a> which adds support for test driven development using <a href="https://mochajs.org/">mocha</a></p> <p><strong>THIS PLUGIN REQUIRES SERVERLESS V1!</strong></p> <p>More familiar with Jest? Use <a href="https://github.com/sc5/serverless-jest-plugin">serverless-jest-plugin</a>.</p> <h2 id="introduction">Introduction</h2> <p>This plugins does the following:</p> <ul> <li>It provides commands to create and run tests manually</li> <li>It provides a command to create a function, which automatically also creates a test</li> </ul> <h2 id="installation">Installation</h2> <p>In your service root, run:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install --save-dev serverless-mocha-plugin
</code></pre></div> <p>Add the plugin to <code class="highlighter-rouge">serverless.yml</code>:</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-mocha-plugin</span>
</code></pre></div> <h2 id="usage">Usage</h2> <h3 id="creating-functions">Creating functions</h3> <p>Functions (and associated tests) can be created using the command</p> <div class="highlighter-rouge"><pre class="highlight"><code>sls create function -f functionName --handler handler
</code></pre></div> <p>e.g.</p> <div class="highlighter-rouge"><pre class="highlight"><code>sls create function -f myFunction --handler functions/myFunction/index.handler
</code></pre></div> <p>creates a new function <code class="highlighter-rouge">myFunction</code> into <code class="highlighter-rouge">serverless.yml</code> with a code template for the handler in <code class="highlighter-rouge">functions/myFunction/index.js</code> and a Javascript function <code class="highlighter-rouge">module.exports.handler</code> as the entrypoint for the Lambda function. A test template is also created into <code class="highlighter-rouge">test/myFunction.js</code>. Optionally tests can be created to specific folder using <code class="highlighter-rouge">--path</code> or <code class="highlighter-rouge">-p</code> switch, e.g.</p> <div class="highlighter-rouge"><pre class="highlight"><code>sls create function -f myFunction --handler functions/myFunction/index.handler --path tests
</code></pre></div> <p>To create an http event for the lambda, add the –httpEvent parameter, i.e.</p> <div class="highlighter-rouge"><pre class="highlight"><code>sls create function -f myFunction --handler functions/myFunction/index.handler --httpEvent "[httpVerb] [relativePath]"
</code></pre></div> <p>e.g.</p> <div class="highlighter-rouge"><pre class="highlight"><code>sls create function -f myFunction --handler functions/myFunction/index.handler --httpEvent "post myResource" --httpEvent "get myResource"
</code></pre></div> <h3 id="creating-tests">Creating tests</h3> <p>Functions can also be added manually using the mocha-create command</p> <div class="highlighter-rouge"><pre class="highlight"><code>sls create test -f functionName
</code></pre></div> <p>If you want to run the tests against the real Lambda functions, you can pass the liveFunction object to wrapper.init().</p> <div class="highlighter-rouge"><pre class="highlight"><code>  wrapper.init(liveFunction);
</code></pre></div> <p>NOTE: Live running does not currently work. Waiting for serverless 1.0 to finalize / have required env variables available</p> <h3 id="running-tests">Running tests</h3> <p>Tests can be run directly using the “invoke test” command. This also initializes the environment variables based on your serverless.yml file and the SERVERLESS_TEST_ROOT variable that defines the root for the code to be tested.</p> <div class="highlighter-rouge"><pre class="highlight"><code>sls invoke test [--stage stage] [--region region] [-f function1] [-f function2] [...]
</code></pre></div> <p>To use a mocha reporter (e.g. json), use the -R switch. Reporter options can be passed with the -O switch.</p> <p>If no function names are passed to “invoke test”, all tests are run from the test/ directory and subdirectories.</p> <p>The default timeout for tests is 6 seconds. In case you need to apply a different timeout, that can be done in the test file using using .timeout(milliseconds) with the define, after, before or it -blocks. e.g.</p> <div class="highlighter-rouge"><pre class="highlight"><code>  it('implement tests here', () =&gt; {
    ...
  }).timeout(xxx);
</code></pre></div> <p>To run test in specific folder use <code class="highlighter-rouge">--path</code> or <code class="highlighter-rouge">-p</code> switch.</p> <p>To run tests live against the actual deployed Lambdas, use the ‘–live’ or ‘-l’ switch. Please note that this will work only for tests created with module version 1.4 or higher.</p> <p>To run tests e.g. against built artefacts that reside in some other directory, use the ‘–root’ or ‘-r’ switch. e.g.</p> <div class="highlighter-rouge"><pre class="highlight"><code>  sls webpack -o testBuild
  sls invoke test -r testBuild
  rm -rf testBuild
</code></pre></div> <h3 id="using-own-template-for-a-test-file">Using own template for a test file</h3> <p>The templates to use for new function Files can be determined with the custom <code class="highlighter-rouge">testTemplate</code> configuration in <code class="highlighter-rouge">serverless.yml</code></p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">serverless-mocha-plugin</span><span class="pi">:</span>
    <span class="s">testTemplate</span><span class="pi">:</span> <span class="s">templates/myTest.js</span>
</code></pre></div> <p>Currently, there are three variables available for use in the template:</p> <ul> <li>functionName - name of the function</li> <li>functionPath - path to the function</li> <li>handlerName - the name of the handler function</li> </ul> <p>If you’d like to get more information on the template engine, you check documentation of the <a href="http://ejs.co/">EJS project</a>.</p> <h3 id="using-own-template-for-function-file">Using own template for function file</h3> <p>The templates to use for new function Files can be determined with the custom <code class="highlighter-rouge">functionTemplate</code> configuration in <code class="highlighter-rouge">serverless.yml</code></p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">serverless-mocha-plugin</span><span class="pi">:</span>
    <span class="s">functionTemplate</span><span class="pi">:</span> <span class="s">templates/myFunction.js</span>
</code></pre></div> <h3 id="running-commands-before--after-tests">Running commands before / after tests</h3> <p>The plugin can be configured to run commands before / after the tests. This is done by setting preTestCommands and postTestCommands in the plugin configuration.</p> <p>For example, start serverless-offline before tests and stop it after tests using the following configuration:</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">serverless-mocha-plugin</span><span class="pi">:</span>
    <span class="s">preTestCommands</span><span class="pi">:</span> 
      <span class="pi">-</span> <span class="s">bash startOffline.sh</span>
    <span class="s">postTestCommands</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">bash stopOffline.sh</span>
</code></pre></div> <p>Sample startOffline.sh:</p> <div class="highlighter-rouge"><pre class="highlight"><code>TMPFILE=/var/tmp/offline$$.log
if [ -f .offline.pid ]; then
    echo "Found file .offline.pid. Not starting."
    exit 1
fi

serverless offline start 2&gt;1 &gt; $TMPFILE &amp;
PID=$!
echo $PID &gt; .offline.pid

while ! grep "Offline listening" $TMPFILE
do sleep 1; done

rm $TMPFILE
</code></pre></div> <p>Sample stopOffline.sh</p> <div class="highlighter-rouge"><pre class="highlight"><code>kill `cat .offline.pid`
rm .offline.pid
</code></pre></div> <h2 id="release-history-1x">Release History (1.x)</h2> <ul> <li>2017/09/10 - v1.7.0 - ability to run scripts before / after tests</li> <li>2017/09/09 - v1.6.0 - also run tests from subfolders of test</li> <li>2017/07/11 - v1.4.1 - Add option –root for running tests on e.g. webpack build results residing in other directories, add option –httpEvent to create http events when creating functions</li> <li>2017/07/09 - v1.4.0 - Add –live switch, add –grep switch, verify that the test runtime matches the service runtime, upgrade lambda-wrapper (returns exceptions as errors)</li> <li>2016/12/21 - v1.3.2 - Fix population of environment variables</li> <li>2016/11/28 - v1.3.1 - Added support for environment variables in Serverless 1.2</li> <li>2016/11/09 - v1.2.0 - Added ability to add function / test templates</li> <li>2016/11/09 - v1.1.0 - Added function create command.</li> <li>2016/09/23 - v1.0.2 - Bugfixes, configurable test timeouts</li> <li>2016/08/15 - v1.0.0 - Preliminary version for Serverless 1.0</li> </ul> <h2 id="license">License</h2> <p>Copyright (c) 2017 <a href="http://sc5.io/">SC5</a>, licensed for users and contributors under MIT license. https://github.com/SC5/serverless-mocha-plugin/blob/master/LICENSE</p> </section> <footer class="cf w-100"> <div class="cover bg-left bg-center-l pv5" style="background-image: url(/img/bg.png)"> <form action="//tachyonstemplates.us16.list-manage.com/subscribe/post?u=3ff847fac68c99ba4cbf378be&amp;id=8eb026def6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="center pa3" target="_blank" novalidate> <div> <h3 class="pa0 f3 f2-ns mb3 mt0 white tc">Want more Serverless?</h3> <h5 class="pa0 f4 f3-ns mb3 white tc">Subscribe to our mailing list to receive an update when new items arrive!</h5> <div class="cf mw7 center"> <label class="clip" for="email-address">Email Address</label> <input placeholder="Your Email Address" type="email" name="EMAIL" class="f6 f5-l input-reset bn fl black-80 bg-white pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns"> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3ff847fac68c99ba4cbf378be_8eb026def6" tabindex="-1" value=""></div> <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-black-70 hover-bg-black white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" name="subscribe" type="submit" value="Subscribe"> </div> </div> </form> </div> <div class="pb4 pt2 ph3 ph5-ns tc lh-copy"> <a class="pv2 db ph3 dim" href="/">Serverless Directory - Plugins, Frameworks, Consultants</a> <a class="pv2 db ph3 dim" href="/frameworks/">Serverless Frameworks Directory</a> <a class="pv2 db ph3 dim" href="/plugins/">Serverless Plugin Directory</a> <a class="pv2 db ph3 dim" href="/plugins/topics/">Serverless Plugin Topics</a> </div> </footer> <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script> <!-- keeping this here for prosperity --> </body> </html>
