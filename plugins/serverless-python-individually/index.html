<!DOCTYPE html> <html> <head> <script type="text/javascript"> var host = 'www.serverlessconsultants.com'; if (host == window.location.host && window.location.protocol != 'https:') { window.location.protocol = 'https'; } </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content="Serverless Directory"> <meta name="msvalidate.01" content="0C81C6A5BD3BAF86F4730D8C4A9BF223" /> <meta name="google-site-verification" content=""> <title>Serverless Python Individually - Serverless Plugin Directory</title> <!-- Google+ Authorship --> <link rel="author" href="Serverless Directory"> <link rel="publisher" href="Serverless Directory"> <!-- Canonical --> <link rel="canonical" href="https://www.serverlessconsultants.com/plugins/serverless-python-individually/"> <!-- Fonts --> <link href='https://fonts.googleapis.com/css?family=Libre+Franklin:400,100,100italic,200,200italic,300,300italic,400italic,500,600,500italic,600italic,700,700italic,800,900,800italic,900italic' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'> <!-- Styles --> <link rel="stylesheet" href=" /css/main.css "> <!-- Feed --> <link rel="alternate" type="application/rss+xml" title="ServerLess Directory" href="https://www.serverlessconsultants.com /feed.xml "> <!-- Fav Icon and Apple Touch Icons --> <link rel="icon" type="image/png" href="/img/favicon.png" sizes="128x128" /> <meta name="application-name" content="ServerLess Directory" /> <!-- Open Graph --> <meta property="og:title" content="Serverless Python Individually - Serverless Plugin Directory"> <meta property="og:site_name" content="ServerLess Directory"> <meta property="og:type" content="website"> <meta property="og:description" content="Open Issue Count: 0, Stargazer Count: 8, Forks Count: 7, Watchers Count: 8."> </head> <script type="text/javascript"> (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]); a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga('create', 'UA-61052500-12', 'auto'); ga('send', 'pageview'); </script> <body> <!-- Navigation --> <header class="bg-white w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-999 bb b--light-gray"> <nav class="tc"> <a class="dib no-underline v-mid tc bw1 ba b gold ph1 pv2 outline b--gold" href="/" rel="nofollow"> <div>SRVR</div> <div>LSS</div> </a> <a class="link dim black b f6 f5-ns dib mr3" href="/" title="Serverless Directory">Serverless Directory</a> <a class="link dim gray f6 f5-ns dib mr3" href="/plugins/">Serverless Plugins</a> <a class="link dim gray f6 f5-ns dib mr3" href="/frameworks/">Serverless Frameworks</a> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/consultants/">Serverless Consultants</a> --> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/contact" title="Contact Serverless Frameworks Directory">Contact</a> --> </nav> </header> <div class="mw8 center"> <h1 class="tc ma0">Serverless Python Individually</h1> <div class="tc"> <a rel="nofollow noreferrer noopener" href="https://github.com/cfchou/serverless-python-individually"> <img src="https://icon.now.sh/home" alt="homepage icon"> https://github.com/cfchou/serverless-python-individually </a> </div> <article class="ph3 ph5-ns"> <h3 class="f6 ma0 pa0 ttu tc tracked">Tracked</h3> <div class="cf tc"> <dl title="NPM Downloads Last Month: 541" class="db tc mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">NPM Downloads Last Month</dd> <dd class="f3 fw6 ml0">541</dd> </dl> <dl title="Open Issue Count: 0" class="fl fn-l w-50 mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Issues</dd> <dd class="f3 fw6 ml0">0</dd> </dl> <dl title="Stargazer Count: 8" class="fl fn-l w-50 dib-l mb0 w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Stars</dd> <dd class="f3 fw6 ml0">8</dd> </dl> <dl title="Forks Count: 7" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title mr5-l"> <dd class="f6 fw4 ml0">Forks</dd> <dd class="f3 fw6 ml0">7</dd> </dl> <dl title="Watchers Count: 8" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title"> <dd class="f6 fw4 ml0">Watchers</dd> <dd class="f3 fw6 ml0">8</dd> </dl> </div> </article> <!-- TODO: FIX THIS --> <div class="cf tc mw6 center dn"> </div> </div> <h3 class="tc">Repo README Contents:</h3> <section class="mw8 center ph3 pv2 overflow-x-scroll ba br3" id="readme-content"> <h1 id="serverless-python-individually">serverless-python-individually</h1> <p><a href="http://www.serverless.com"><img src="http://public.serverless.com/badges/v3.svg" alt="serverless" /></a></p> <ul> <li><a href="#whats-it">What’s it?</a></li> <li><a href="#whats-new">What’s new?</a></li> <li><a href="#why-do-i-need-it">Why do I need it?</a></li> <li><a href="#how">How?</a></li> <li><a href="#how-to-install-platform-dependent-packages">How to install platform-dependent packages?</a></li> <li><a href="#advanced-configuration">Advanced configuration</a></li> <li><a href="#demo">Demo</a></li> <li><a href="#credit">Credit</a></li> <li><a href="#note">Note</a></li> </ul> <h1 id="whats-it">What’s it?</h1> <p>It’s a simple plugin for serverless <strong>1.3+</strong> that makes it easier to package multiple lambda functions written in python.</p> <h1 id="whats-new">What’s new?</h1> <ul> <li>Since <strong>0.1.6</strong> python3.6 is supported.</li> <li>Since <strong>0.1.5</strong> lambda functions placed under subdirectories are supported.</li> </ul> <h1 id="why-do-i-need-it">Why do I need it?</h1> <p>Say you have multiple lambda functions and each of them has fairly different package requirements. It’s not economical to pack all dependencies in one big fat zip. Instead, this plugin can help to pack lambda functions with their own dependencies if you create <strong>requirements.txt</strong> for every function:</p> <div class="highlighter-rouge"><pre class="highlight"><code>project
├── hello
│   ├── handler.py
│   └── requirements.txt
├── world
│   ├── handler.py
│   └── requirements.txt
└── serverless.yml
</code></pre></div> <p>That way, this plugin can help to pack lambda functions with their own dependencies.</p> <p>Moreover, if you are on a Mac, thanks to <a href="https://github.com/lambci/docker-lambda">@docker-lambda</a>, it can pull packages for Linux x86_64 too. More on that please read <a href="#how-to-install-platform-dependent-packages">How to install platform-dependent packages</a>.</p> <h1 id="how">How?</h1> <p>Be sure that <a href="https://pypi.python.org/pypi/virtualenv/">virtualenv</a> is installed. Otherwise,</p> <p><code class="highlighter-rouge">pip install virtualenv</code></p> <p>Then,</p> <p><code class="highlighter-rouge">npm install serverless-python-individually</code></p> <p>Your original <strong>serverless.yml</strong> may look like:</p> <div class="highlighter-rouge"><pre class="highlight"><code>functions:
  helloFunc:
    handler: hello/handler.hello
  worldFunc:
    handler: world/handler.world
</code></pre></div> <p>The plugin works by replacing the <strong>real handlers</strong>(e.g. <code class="highlighter-rouge">hello/handler.hello</code>) with a wrapper generated on the fly(e.g. <code class="highlighter-rouge">hello/wrap.handler</code>). The real handlers are instead set in <strong>custom.pyIndividually</strong> section.</p> <p>A modification to <strong>serverless.yml</strong> is needed:</p> <div class="highlighter-rouge"><pre class="highlight"><code>package:
  individually: True
  exclude:
    # Exclude everything first.
    - '**/*'
functions:
  helloFunc:
    handler: hello/wrap.handler
    package:
      include:
        - hello/**
  worldFunc:
    handler: world/wrap.handler
    package:
      include:
        - world/**
custom:
  pyIndividually:
    wrap:helloFunc: hello/handler.hello     # mapping to the real handler
    wrap:worldFunnc: world/handler.world    # mapping to the real handler

plugins:
  - serverless-python-individually
</code></pre></div> <p>After <strong>sls deploy</strong>, you end up having many .zip in <strong>.serverless/</strong>. They are the actual artifacts that got uploaded to AWS Lambda by serverless. You can examine their content like:</p> <div class="highlighter-rouge"><pre class="highlight"><code>&gt; tar tvzf .serverless/aws-python-dev-helloFunc.zip

hello/handler.py
hello/requirements.txt
hello/wrap.py
hello/lib/pkg_resources/...
hello/lib/requests-2.12.3.dist-info/...
hello/lib/requests/...
hello/lib/...

</code></pre></div> <p>Notice that <strong>wrap.py</strong> and <strong>lib/</strong> are created for you. All dependencies should have been pulled and installed in <strong>lib/</strong>. This plugin also works for <strong>sls deploy function -f</strong>.</p> <h1 id="how-to-install-platform-dependent-packages">How to install platform-dependent packages</h1> <p>If you are on a Mac, there’re platform-dependent dependencies like <em>subprocess32</em>, <em>bcrypt</em>, etc., cannot simply be pip installed. One way to get around is to launch a aws-lambda architecture identical EC2 or a VM to do the job. That’s inconvenient to say the least. Thanks to <a href="https://github.com/lambci/docker-lambda">@docker-lambda</a>, we can launch a container for the same purpose at our disposal. All you need to do is:</p> <ul> <li>Make sure <a href="https://docs.docker.com/engine/installation/mac/">docker</a> is installed and properly set up. I.e. when running <code class="highlighter-rouge">docker version</code> you should see information about client and server.</li> <li>For python2.7, <code class="highlighter-rouge">docker pull lambci/lambda:build-python2.7</code> to pull the image in advance.</li> <li>For python3.6, <code class="highlighter-rouge">docker pull lambci/lambda:build-python3.6</code> to pull the image in advance.</li> <li>Turn on <strong>dockerizedPip</strong> in <strong>serverless.yml</strong>: <div class="highlighter-rouge"><pre class="highlight"><code>  custom:
      pyIndividually:
          # ...

          # Launches a container for installing packages.
          # The default is False.
          dockerizedPip: True
</code></pre></div> </li> </ul> <h1 id="advanced-configuration">Advanced configuration</h1> <p>There are a couple of configurations that can be handy for you.</p> <h3 id="severlessyml">severless.yml</h3> <ul> <li><strong>wrap.py</strong> and <strong>lib/</strong> are created during packaging in the same directory where the real handler is. If you are not happy about the naming, you can change <code class="highlighter-rouge">wrapName</code> and <code class="highlighter-rouge">libSubDir</code>.</li> <li><strong>wrap.py</strong> and <strong>lib/</strong> by default will be deleted after packaging. They can be preserved by setting <code class="highlighter-rouge">cleanup</code> to False.</li> </ul> <div class="highlighter-rouge"><pre class="highlight"><code>custom:
  pyIndividually:
    # A ${wrapName}.py will be generated for every function.
    # The default filename is 'wrap.py', but you can change it to avoid name clashes.
    wrapName: wrapFoo

    # pip install packages to ${libSubDir} along with ${wrapNam}.py
    # The default dir is 'lib'.
    # libSubDir: lib

    # Cleanup ${libSubDir} and ${wrapName}.py created by the plugin.
    # The default is True.
    # cleanup: True

    # Mapping to the real handler of every function. In the format:
    # ${wrapName}:function_name: real_handler
    # If there's no mapping for a function, then that function will not be touced by this plugin.
    wrapFoo:helloFunc: hello/handler.hello
    wrapFoo:worldFunnc: world/handler.world

    # See [How to install platform-dependent package]
    # The default is False.
    # dockerizedPip: False

</code></pre></div> <h3 id="command-line-options">Command line options</h3> <p>You can also overwrite some configurations through extra options when <code class="highlighter-rouge">sls deploy</code>.</p> <ul> <li> <p><code class="highlighter-rouge">--pi-cleanup</code>/<code class="highlighter-rouge">--pi-no-cleanup</code> overwrite <code class="highlighter-rouge">cleanup</code> in serverless.yml.</p> </li> <li> <p><code class="highlighter-rouge">--pi-dockerizedPip</code>/<code class="highlighter-rouge">--pi-no-dockerizedPip</code> overwrite <code class="highlighter-rouge">dockerizedPip</code> in serverless.yml.</p> </li> <li> <p><code class="highlighter-rouge">--pi-disable</code> skips this plugin.</p> </li> <li> <p>Handy but <strong>USE WITH CAUTION</strong>: If <code class="highlighter-rouge">--pi-no-cleanup</code> was specified previously and you don’t want to pull dependencies again, then you can disable this plugin temporarily with <code class="highlighter-rouge">--pi-disable</code>. sls would pack what’s left over in the directory:</p> </li> </ul> <div class="highlighter-rouge"><pre class="highlight"><code>$&gt; sls deploy --pi-no-cleanup
Now wrap.py and lib/* are not cleaned. You can do some work. Make sure requirements.txt not being changed anyhow.
$&gt; sls deploy --pi-disable
The plugin is disabled for this time. sls should then directly pack wrap.py and lib/* left last time.
</code></pre></div> <h1 id="demo">Demo</h1> <p>A <a href="https://github.com/cfchou/serverless-python-individually-demo">demo</a> is there for you to get started.</p> <h1 id="credit">Credit</h1> <p>This plugin is heavily influenced by <a href="https://github.com/logandk/serverless-wsgi">serverless-wsgi</a> from <a href="https://github.com/logandk">@logandk</a>. In fact, the <a href="https://github.com/cfchou/serverless-python-individually/blob/master/requirements.py">requirement installer</a> is directly borrowed from his repo. If your lambda is a wsgi app, then must check out his work.</p> <p>Also thanks to <a href="https://github.com/lambci/docker-lambda">@docker-lambda</a> to provide aws lambda runtime equivalent docker image.</p> <h1 id="note">Note</h1> <p>As of this writing, I just start using serverless <strong>1.3+</strong>. This plugin may or may not work with other 1.x versions but I haven’t tried.</p> </section> <footer class="cf w-100"> <div class="cover bg-left bg-center-l pv5" style="background-image: url(/img/bg.png)"> <form action="//tachyonstemplates.us16.list-manage.com/subscribe/post?u=3ff847fac68c99ba4cbf378be&amp;id=8eb026def6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="center pa3" target="_blank" novalidate> <div> <h3 class="pa0 f3 f2-ns mb3 mt0 white tc">Want more Serverless?</h3> <h5 class="pa0 f4 f3-ns mb3 white tc">Subscribe to our mailing list to receive an update when new items arrive!</h5> <div class="cf mw7 center"> <label class="clip" for="email-address">Email Address</label> <input placeholder="Your Email Address" type="email" name="EMAIL" class="f6 f5-l input-reset bn fl black-80 bg-white pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns"> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3ff847fac68c99ba4cbf378be_8eb026def6" tabindex="-1" value=""></div> <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-black-70 hover-bg-black white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" name="subscribe" type="submit" value="Subscribe"> </div> </div> </form> </div> <div class="pb4 pt2 ph3 ph5-ns tc lh-copy"> <a class="pv2 db ph3 dim" href="/">Serverless Directory - Plugins, Frameworks, Consultants</a> <a class="pv2 db ph3 dim" href="/frameworks/">Serverless Frameworks Directory</a> <a class="pv2 db ph3 dim" href="/plugins/">Serverless Plugin Directory</a> <a class="pv2 db ph3 dim" href="/plugins/topics/">Serverless Plugin Topics</a> </div> </footer> <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script> <!-- keeping this here for prosperity --> </body> </html>
