<!DOCTYPE html> <html> <head> <script type="text/javascript"> var host = 'www.serverlessconsultants.com'; if (host == window.location.host && window.location.protocol != 'https:') { window.location.protocol = 'https'; } </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content="Serverless Directory"> <meta name="msvalidate.01" content="0C81C6A5BD3BAF86F4730D8C4A9BF223" /> <meta name="google-site-verification" content=""> <title>Serverless Step Functions - Serverless Plugin Directory</title> <!-- Google+ Authorship --> <link rel="author" href="Serverless Directory"> <link rel="publisher" href="Serverless Directory"> <!-- Canonical --> <link rel="canonical" href="https://www.serverlessconsultants.com/plugins/serverless-step-functions/"> <!-- Fonts --> <link href='https://fonts.googleapis.com/css?family=Libre+Franklin:400,100,100italic,200,200italic,300,300italic,400italic,500,600,500italic,600italic,700,700italic,800,900,800italic,900italic' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'> <!-- Styles --> <link rel="stylesheet" href=" /css/main.css "> <!-- Feed --> <link rel="alternate" type="application/rss+xml" title="ServerLess Directory" href="https://www.serverlessconsultants.com /feed.xml "> <!-- Fav Icon and Apple Touch Icons --> <link rel="icon" type="image/png" href="/img/favicon.png" sizes="128x128" /> <meta name="application-name" content="ServerLess Directory" /> <!-- Open Graph --> <meta property="og:title" content="Serverless Step Functions - Serverless Plugin Directory"> <meta property="og:site_name" content="ServerLess Directory"> <meta property="og:type" content="website"> <meta property="og:description" content="Open Issue Count: 8, Stargazer Count: 171, Forks Count: 18, Watchers Count: 171."> </head> <script type="text/javascript"> (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]); a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga('create', 'UA-61052500-12', 'auto'); ga('send', 'pageview'); </script> <body> <!-- Navigation --> <header class="bg-white w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-999 bb b--light-gray"> <nav class="tc"> <a class="dib no-underline v-mid tc bw1 ba b gold ph1 pv2 outline b--gold" href="/" rel="nofollow"> <div>SRVR</div> <div>LSS</div> </a> <a class="link dim black b f6 f5-ns dib mr3" href="/" title="Serverless Directory">Serverless Directory</a> <a class="link dim gray f6 f5-ns dib mr3" href="/plugins/">Serverless Plugins</a> <a class="link dim gray f6 f5-ns dib mr3" href="/frameworks/">Serverless Frameworks</a> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/consultants/">Serverless Consultants</a> --> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/contact" title="Contact Serverless Frameworks Directory">Contact</a> --> </nav> </header> <div class="mw8 center"> <h1 class="tc ma0">Serverless Step Functions</h1> <div class="tc"> <a rel="nofollow noreferrer noopener" href="https://github.com/horike37/serverless-step-functions"> <img src="https://icon.now.sh/home" alt="homepage icon"> https://github.com/horike37/serverless-step-functions </a> </div> <article class="ph3 ph5-ns"> <h3 class="f6 ma0 pa0 ttu tc tracked">Tracked</h3> <div class="cf tc"> <dl title="NPM Downloads Last Month: 1512" class="db tc mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">NPM Downloads Last Month</dd> <dd class="f3 fw6 ml0">1512</dd> </dl> <dl title="Open Issue Count: 8" class="fl fn-l w-50 mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Issues</dd> <dd class="f3 fw6 ml0">8</dd> </dl> <dl title="Stargazer Count: 171" class="fl fn-l w-50 dib-l mb0 w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Stars</dd> <dd class="f3 fw6 ml0">171</dd> </dl> <dl title="Forks Count: 18" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title mr5-l"> <dd class="f6 fw4 ml0">Forks</dd> <dd class="f3 fw6 ml0">18</dd> </dl> <dl title="Watchers Count: 171" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title"> <dd class="f6 fw4 ml0">Watchers</dd> <dd class="f3 fw6 ml0">171</dd> </dl> </div> </article> <!-- TODO: FIX THIS --> <div class="cf tc mw6 center dn"> </div> </div> <h3 class="tc">Repo README Contents:</h3> <section class="mw8 center ph3 pv2 overflow-x-scroll ba br3" id="readme-content"> <p><a href="http://www.serverless.com"><img src="http://public.serverless.com/badges/v3.svg" alt="serverless" /></a> <a href="https://travis-ci.org/horike37/serverless-step-functions"><img src="https://travis-ci.org/horike37/serverless-step-functions.svg?branch=master" alt="Build Status" /></a> <a href="https://badge.fury.io/js/serverless-step-functions"><img src="https://badge.fury.io/js/serverless-step-functions.svg" alt="npm version" /></a> <a href="https://coveralls.io/github/horike37/serverless-step-functions?branch=master"><img src="https://coveralls.io/repos/github/horike37/serverless-step-functions/badge.svg?branch=master" alt="Coverage Status" /></a> <a href="LICENSE"><img src="http://img.shields.io/badge/license-MIT-blue.svg?style=flat" alt="MIT License" /></a></p> <h1 id="serverless-step-functions">Serverless Step Functions</h1> <p>Serverless plugin for AWS Step Functions.</p> <h2 id="install">Install</h2> <p>Run <code class="highlighter-rouge">npm install</code> in your Serverless project.</p> <div class="highlighter-rouge"><pre class="highlight"><code>$ npm install --save-dev serverless-step-functions
</code></pre></div> <p>Add the plugin to your serverless.yml file</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-step-functions</span>
</code></pre></div> <h2 id="setup">Setup</h2> <p>Specifies your statemachine definition using Amazon States Language in a <code class="highlighter-rouge">definition</code> statement in serverless.yml.</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">accountId</span><span class="pi">:</span> <span class="s">xxxxxxxx</span>

<span class="s">functions</span><span class="pi">:</span>
  <span class="s">hellofunc</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello</span>

<span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">hellostepfunc1</span><span class="pi">:</span>
      <span class="s">events</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">http</span><span class="pi">:</span>
            <span class="s">path</span><span class="pi">:</span> <span class="s">gofunction</span>
            <span class="s">method</span><span class="pi">:</span> <span class="s">GET</span>
        <span class="pi">-</span> <span class="s">schedule</span><span class="pi">:</span>
            <span class="s">rate</span><span class="pi">:</span> <span class="s">rate(10 minutes)</span>
            <span class="s">enabled</span><span class="pi">:</span> <span class="s">true</span>
            <span class="s">input</span><span class="pi">:</span>
              <span class="s">key1</span><span class="pi">:</span> <span class="s">value1</span>
              <span class="s">key2</span><span class="pi">:</span> <span class="s">value2</span>
              <span class="s">stageParams</span><span class="pi">:</span>
                <span class="s">stage</span><span class="pi">:</span> <span class="s">dev</span>
      <span class="s">name</span><span class="pi">:</span> <span class="s">myStateMachine</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">Comment</span><span class="pi">:</span> <span class="s2">"</span><span class="s">A</span><span class="nv"> </span><span class="s">Hello</span><span class="nv"> </span><span class="s">World</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Amazon</span><span class="nv"> </span><span class="s">States</span><span class="nv"> </span><span class="s">Language</span><span class="nv"> </span><span class="s">using</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">Lambda</span><span class="nv"> </span><span class="s">Function"</span>
        <span class="s">StartAt</span><span class="pi">:</span> <span class="s">HelloWorld1</span>
        <span class="s">States</span><span class="pi">:</span>
          <span class="s">HelloWorld1</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
    <span class="s">hellostepfunc2</span><span class="pi">:</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">StartAt</span><span class="pi">:</span> <span class="s">HelloWorld2</span>
        <span class="s">States</span><span class="pi">:</span>
          <span class="s">HelloWorld2</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:states:${opt:region}:${self:custom.accountId}:activity:myTask</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
  <span class="s">activities</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">myTask</span>
    <span class="pi">-</span> <span class="s">yourTask</span>
</code></pre></div> <h3 id="adding-a-custom-name-for-a-statemachine">Adding a custom name for a stateMachine</h3> <p>In case you need to interpolate a specific stage or service layer variable as the stateMachines name you can add a <code class="highlighter-rouge">name</code> property to your yaml.</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">service</span><span class="pi">:</span> <span class="s">messager</span>

<span class="s">functions</span><span class="pi">:</span>
  <span class="s">sendMessage</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.sendMessage</span>

<span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">sendMessageFunc</span><span class="pi">:</span>
      <span class="s">name</span><span class="pi">:</span> <span class="s">sendMessageFunc-${self:custom.service}-${opt:stage}</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">&lt;your definition&gt;</span>

<span class="s">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-step-functions</span>
</code></pre></div> <p>Please note, that during normalization some characters will be changed to adhere to CloudFormation templates. You can get the real statemachine name using <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="nt">"Fn::GetAtt"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"MyStateMachine"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Name"</span><span class="p">]</span><span class="w"> </span><span class="p">}</span></code>.</p> <h2 id="events">Events</h2> <h3 id="api-gateway">API Gateway</h3> <p>To create HTTP endpoints as Event sources for your StepFunctions statemachine</p> <h4 id="simple-http-endpoint">Simple HTTP Endpoint</h4> <p>This setup specifies that the hello statemachine should be run when someone accesses the API gateway at hello via a GET request.</p> <p>Here’s an example:</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">hello</span><span class="pi">:</span>
      <span class="s">events</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">http</span><span class="pi">:</span>
            <span class="s">path</span><span class="pi">:</span> <span class="s">hello</span>
            <span class="s">method</span><span class="pi">:</span> <span class="s">GET</span>
      <span class="s">definition</span><span class="pi">:</span>
</code></pre></div> <h4 id="http-endpoint-with-extended-options">HTTP Endpoint with Extended Options</h4> <p>Here You can define an POST endpoint for the path posts/create.</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">hello</span><span class="pi">:</span>
      <span class="s">events</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">http</span><span class="pi">:</span>
            <span class="s">path</span><span class="pi">:</span> <span class="s">posts/create</span>
            <span class="s">method</span><span class="pi">:</span> <span class="s">POST</span>
      <span class="s">definition</span><span class="pi">:</span>
</code></pre></div> <h4 id="enabling-cors">Enabling CORS</h4> <p>To set CORS configurations for your HTTP endpoints, simply modify your event configurations as follows:</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">hello</span><span class="pi">:</span>
      <span class="s">events</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">http</span><span class="pi">:</span>
            <span class="s">path</span><span class="pi">:</span> <span class="s">posts/create</span>
            <span class="s">method</span><span class="pi">:</span> <span class="s">POST</span>
            <span class="s">cors</span><span class="pi">:</span> <span class="s">true</span>
      <span class="s">definition</span><span class="pi">:</span>
</code></pre></div> <p>Setting cors to true assumes a default configuration which is equivalent to:</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">hello</span><span class="pi">:</span>
      <span class="s">events</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">http</span><span class="pi">:</span>
            <span class="s">path</span><span class="pi">:</span> <span class="s">posts/create</span>
            <span class="s">method</span><span class="pi">:</span> <span class="s">POST</span>
            <span class="s">cors</span><span class="pi">:</span>
              <span class="s">origin</span><span class="pi">:</span> <span class="s1">'</span><span class="s">*'</span>
              <span class="s">headers</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">Content-Type</span>
                <span class="pi">-</span> <span class="s">X-Amz-Date</span>
                <span class="pi">-</span> <span class="s">Authorization</span>
                <span class="pi">-</span> <span class="s">X-Api-Key</span>
                <span class="pi">-</span> <span class="s">X-Amz-Security-Token</span>
                <span class="pi">-</span> <span class="s">X-Amz-User-Agent</span>
              <span class="s">allowCredentials</span><span class="pi">:</span> <span class="s">false</span>
      <span class="s">definition</span><span class="pi">:</span>
</code></pre></div> <p>Configuring the cors property sets Access-Control-Allow-Origin, Access-Control-Allow-Headers, Access-Control-Allow-Methods,Access-Control-Allow-Credentials headers in the CORS preflight response.</p> <h4 id="send-request-to-an-api">Send request to an API</h4> <p>You can input an value as json in request body, the value is passed as the input value of your statemachine</p> <div class="highlighter-rouge"><pre class="highlight"><code>$ curl -XPOST https://xxxxxxxxx.execute-api.us-east-1.amazonaws.com/dev/posts/create -d '{"foo":"bar"}'
</code></pre></div> <h3 id="schedule">Schedule</h3> <p>The following config will attach a schedule event and causes the stateMachine <code class="highlighter-rouge">crawl</code> to be called every 2 hours. The configuration allows you to attach multiple schedules to the same stateMachine. You can either use the <code class="highlighter-rouge">rate</code> or <code class="highlighter-rouge">cron</code> syntax. Take a look at the <a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html">AWS schedule syntax documentation</a> for more details.</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">crawl</span><span class="pi">:</span>
      <span class="s">events</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">schedule</span><span class="pi">:</span> <span class="s">rate(2 hours)</span>
        <span class="pi">-</span> <span class="s">schedule</span><span class="pi">:</span> <span class="s">cron(0 12 * * ? *)</span>
      <span class="s">definition</span><span class="pi">:</span>
</code></pre></div> <h2 id="enabling--disabling">Enabling / Disabling</h2> <p><strong>Note:</strong> <code class="highlighter-rouge">schedule</code> events are enabled by default.</p> <p>This will create and attach a schedule event for the <code class="highlighter-rouge">aggregate</code> stateMachine which is disabled. If enabled it will call the <code class="highlighter-rouge">aggregate</code> stateMachine every 10 minutes.</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">aggregate</span><span class="pi">:</span>
      <span class="s">events</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">schedule</span><span class="pi">:</span>
            <span class="s">rate</span><span class="pi">:</span> <span class="s">rate(10 minutes)</span>
            <span class="s">enabled</span><span class="pi">:</span> <span class="s">false</span>
            <span class="s">input</span><span class="pi">:</span>
              <span class="s">key1</span><span class="pi">:</span> <span class="s">value1</span>
              <span class="s">key2</span><span class="pi">:</span> <span class="s">value2</span>
              <span class="s">stageParams</span><span class="pi">:</span>
                <span class="s">stage</span><span class="pi">:</span> <span class="s">dev</span>
        <span class="pi">-</span> <span class="s">schedule</span><span class="pi">:</span>
            <span class="s">rate</span><span class="pi">:</span> <span class="s">cron(0 12 * * ? *)</span>
            <span class="s">enabled</span><span class="pi">:</span> <span class="s">false</span>
            <span class="s">inputPath</span><span class="pi">:</span> <span class="s1">'</span><span class="s">$.stageVariables'</span>
</code></pre></div> <h2 id="specify-name-and-description">Specify Name and Description</h2> <p>Name and Description can be specified for a schedule event. These are not required properties.</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">events</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">schedule</span><span class="pi">:</span>
      <span class="s">name</span><span class="pi">:</span> <span class="s">your-scheduled-rate-event-name</span>
      <span class="s">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">your</span><span class="nv"> </span><span class="s">scheduled</span><span class="nv"> </span><span class="s">rate</span><span class="nv"> </span><span class="s">event</span><span class="nv"> </span><span class="s">description'</span>
      <span class="s">rate</span><span class="pi">:</span> <span class="s">rate(2 hours)</span>
</code></pre></div> <h2 id="command">Command</h2> <h3 id="deploy">deploy</h3> <p>Runn <code class="highlighter-rouge">sls deploy</code>, the defined Stepfunctions are deployed.</p> <h3 id="invoke">invoke</h3> <div class="highlighter-rouge"><pre class="highlight"><code>$ sls invoke stepf --name &lt;stepfunctionname&gt; --data '{"foo":"bar"}'
</code></pre></div> <h4 id="options">options</h4> <ul> <li>–name or -n The name of the step function in your service that you want to invoke. Required.</li> <li>–stage or -s The stage in your service you want to invoke your step function.</li> <li>–region or -r The region in your stage that you want to invoke your step function.</li> <li>–data or -d String data to be passed as an event to your step function.</li> <li>–path or -p The path to a json file with input data to be passed to the invoked step function.</li> </ul> <h2 id="iam-role">IAM Role</h2> <p>The IAM roles required to run Statemachine are automatically generated. It is also possible to specify ARN directly.</p> <p>Here’s an example:</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">hello</span><span class="pi">:</span>
      <span class="s">role</span><span class="pi">:</span> <span class="s">arn:aws:iam::xxxxxxxx:role/yourRole</span>
      <span class="s">definition</span><span class="pi">:</span>
</code></pre></div> <h2 id="tips">Tips</h2> <h3 id="how-to-specify-the-statemachine-arn-to-environment-variables">How to specify the stateMachine ARN to environment variables</h3> <p>Here is serverless.yml sample to specify the stateMachine ARN to environment variables. This makes it possible to trigger your statemachine through Lambda events</p> <div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="s">functions</span><span class="pi">:</span>
  <span class="s">hello</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello</span>
    <span class="s">environment</span><span class="pi">:</span>
      <span class="s">statemachine_arn</span><span class="pi">:</span> <span class="s">${self:resources.Outputs.MyStateMachine.Value}</span>

<span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">hellostepfunc</span><span class="pi">:</span>
      <span class="s">name</span><span class="pi">:</span> <span class="s">myStateMachine</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">&lt;your definition&gt;</span>

<span class="s">resources</span><span class="pi">:</span>
  <span class="s">Outputs</span><span class="pi">:</span>
    <span class="s">MyStateMachine</span><span class="pi">:</span>
      <span class="s">Description</span><span class="pi">:</span> <span class="s">The ARN of the example state machine</span>
      <span class="s">Value</span><span class="pi">:</span>
        <span class="s">Ref</span><span class="pi">:</span> <span class="s">MyStateMachine</span>

<span class="s">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-step-functions</span>
</code></pre></div> <h2 id="sample-statemachines-setting-in-serverlessyml">Sample statemachines setting in serverless.yml</h2> <h3 id="wait-state">Wait State</h3> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">accountId</span><span class="pi">:</span> <span class="s">&lt;Here is your accountId&gt;</span>

<span class="s">functions</span><span class="pi">:</span>
  <span class="s">hello</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello</span>

<span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">yourWateMachine</span><span class="pi">:</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">Comment</span><span class="pi">:</span> <span class="s2">"</span><span class="s">An</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Amazon</span><span class="nv"> </span><span class="s">States</span><span class="nv"> </span><span class="s">Language</span><span class="nv"> </span><span class="s">using</span><span class="nv"> </span><span class="s">wait</span><span class="nv"> </span><span class="s">states"</span>
        <span class="s">StartAt</span><span class="pi">:</span> <span class="s">FirstState</span>
        <span class="s">States</span><span class="pi">:</span>
          <span class="s">FirstState</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">wait_using_seconds</span>
          <span class="s">wait_using_seconds</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Wait</span>
            <span class="s">Seconds</span><span class="pi">:</span> <span class="s">10</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">wait_using_timestamp</span>
          <span class="s">wait_using_timestamp</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Wait</span>
            <span class="s">Timestamp</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2015-09-04T01:59:00Z'</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">wait_using_timestamp_path</span>
          <span class="s">wait_using_timestamp_path</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Wait</span>
            <span class="s">TimestampPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$.expirydate"</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">wait_using_seconds_path</span>
          <span class="s">wait_using_seconds_path</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Wait</span>
            <span class="s">SecondsPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$.expiryseconds"</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">FinalState</span>
          <span class="s">FinalState</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
</code></pre></div> <h3 id="retry-failture">Retry Failture</h3> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">accountId</span><span class="pi">:</span> <span class="s">&lt;Here is your accountId&gt;</span>

<span class="s">functions</span><span class="pi">:</span>
  <span class="s">hello</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello</span>

<span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">yourRetryMachine</span><span class="pi">:</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">Comment</span><span class="pi">:</span> <span class="s2">"</span><span class="s">A</span><span class="nv"> </span><span class="s">Retry</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Amazon</span><span class="nv"> </span><span class="s">States</span><span class="nv"> </span><span class="s">Language</span><span class="nv"> </span><span class="s">using</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">Lambda</span><span class="nv"> </span><span class="s">Function"</span>
        <span class="s">StartAt</span><span class="pi">:</span> <span class="s">HelloWorld</span>
        <span class="s">States</span><span class="pi">:</span>
          <span class="s">HelloWorld</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello</span>
            <span class="s">Retry</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">ErrorEquals</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">HandledError</span>
              <span class="s">IntervalSeconds</span><span class="pi">:</span> <span class="s">1</span>
              <span class="s">MaxAttempts</span><span class="pi">:</span> <span class="s">2</span>
              <span class="s">BackoffRate</span><span class="pi">:</span> <span class="s">2</span>
            <span class="pi">-</span> <span class="s">ErrorEquals</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">States.TaskFailed</span>
              <span class="s">IntervalSeconds</span><span class="pi">:</span> <span class="s">30</span>
              <span class="s">MaxAttempts</span><span class="pi">:</span> <span class="s">2</span>
              <span class="s">BackoffRate</span><span class="pi">:</span> <span class="s">2</span>
            <span class="pi">-</span> <span class="s">ErrorEquals</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">States.ALL</span>
              <span class="s">IntervalSeconds</span><span class="pi">:</span> <span class="s">5</span>
              <span class="s">MaxAttempts</span><span class="pi">:</span> <span class="s">5</span>
              <span class="s">BackoffRate</span><span class="pi">:</span> <span class="s">2</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
</code></pre></div> <h3 id="parallel">Parallel</h3> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">accountId</span><span class="pi">:</span> <span class="s">&lt;Here is your accountId&gt;</span>

<span class="s">functions</span><span class="pi">:</span>
  <span class="s">hello</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello</span>

<span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">yourParallelMachine</span><span class="pi">:</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">Comment</span><span class="pi">:</span> <span class="s2">"</span><span class="s">An</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Amazon</span><span class="nv"> </span><span class="s">States</span><span class="nv"> </span><span class="s">Language</span><span class="nv"> </span><span class="s">using</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">parallel</span><span class="nv"> </span><span class="s">state</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">execute</span><span class="nv"> </span><span class="s">two</span><span class="nv"> </span><span class="s">branches</span><span class="nv"> </span><span class="s">at</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">same</span><span class="nv"> </span><span class="s">time."</span>
        <span class="s">StartAt</span><span class="pi">:</span> <span class="s">Parallel</span>
        <span class="s">States</span><span class="pi">:</span>
          <span class="s">Parallel</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Parallel</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">Final State</span>
            <span class="s">Branches</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">StartAt</span><span class="pi">:</span> <span class="s">Wait 20s</span>
              <span class="s">States</span><span class="pi">:</span>
                <span class="s">Wait 20s</span><span class="pi">:</span>
                  <span class="s">Type</span><span class="pi">:</span> <span class="s">Wait</span>
                  <span class="s">Seconds</span><span class="pi">:</span> <span class="s">20</span>
                  <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
            <span class="pi">-</span> <span class="s">StartAt</span><span class="pi">:</span> <span class="s">Pass</span>
              <span class="s">States</span><span class="pi">:</span>
                <span class="s">Pass</span><span class="pi">:</span>
                  <span class="s">Type</span><span class="pi">:</span> <span class="s">Pass</span>
                  <span class="s">Next</span><span class="pi">:</span> <span class="s">Wait 10s</span>
                <span class="s">Wait 10s</span><span class="pi">:</span>
                  <span class="s">Type</span><span class="pi">:</span> <span class="s">Wait</span>
                  <span class="s">Seconds</span><span class="pi">:</span> <span class="s">10</span>
                  <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
          <span class="s">Final State</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Pass</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
</code></pre></div> <h3 id="catch-failure">Catch Failure</h3> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">accountId</span><span class="pi">:</span> <span class="s">&lt;Here is your accountId&gt;</span>

<span class="s">functions</span><span class="pi">:</span>
  <span class="s">hello</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello</span>

<span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">yourCatchMachine</span><span class="pi">:</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">Comment</span><span class="pi">:</span> <span class="s2">"</span><span class="s">A</span><span class="nv"> </span><span class="s">Catch</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Amazon</span><span class="nv"> </span><span class="s">States</span><span class="nv"> </span><span class="s">Language</span><span class="nv"> </span><span class="s">using</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">AWS</span><span class="nv"> </span><span class="s">Lambda</span><span class="nv"> </span><span class="s">Function"</span>
        <span class="s">StartAt</span><span class="pi">:</span> <span class="s">HelloWorld</span>
        <span class="s">States</span><span class="pi">:</span>
          <span class="s">HelloWorld</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello</span>
            <span class="s">Catch</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">ErrorEquals</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">HandledError</span>
              <span class="s">Next</span><span class="pi">:</span> <span class="s">CustomErrorFallback</span>
            <span class="pi">-</span> <span class="s">ErrorEquals</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">States.TaskFailed</span>
              <span class="s">Next</span><span class="pi">:</span> <span class="s">ReservedTypeFallback</span>
            <span class="pi">-</span> <span class="s">ErrorEquals</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">States.ALL</span>
              <span class="s">Next</span><span class="pi">:</span> <span class="s">CatchAllFallback</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
          <span class="s">CustomErrorFallback</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Pass</span>
            <span class="s">Result</span><span class="pi">:</span> <span class="s2">"</span><span class="s">This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">fallback</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">custom</span><span class="nv"> </span><span class="s">lambda</span><span class="nv"> </span><span class="s">function</span><span class="nv"> </span><span class="s">exception"</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
          <span class="s">ReservedTypeFallback</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Pass</span>
            <span class="s">Result</span><span class="pi">:</span> <span class="s2">"</span><span class="s">This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">fallback</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">reserved</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">code"</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
          <span class="s">CatchAllFallback</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Pass</span>
            <span class="s">Result</span><span class="pi">:</span> <span class="s2">"</span><span class="s">This</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">fallback</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">reserved</span><span class="nv"> </span><span class="s">error</span><span class="nv"> </span><span class="s">code"</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
</code></pre></div> <h3 id="choice">Choice</h3> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">custom</span><span class="pi">:</span>
  <span class="s">accountId</span><span class="pi">:</span> <span class="s">&lt;Here is your account Id&gt;</span>

<span class="s">functions</span><span class="pi">:</span>
  <span class="s">hello1</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello1</span>
  <span class="s">hello2</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello2</span>
  <span class="s">hello3</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello3</span>
  <span class="s">hello4</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello4</span>

<span class="s">stepFunctions</span><span class="pi">:</span>
  <span class="s">stateMachines</span><span class="pi">:</span>
    <span class="s">yourChoiceMachine</span><span class="pi">:</span>
      <span class="s">definition</span><span class="pi">:</span>
        <span class="s">Comment</span><span class="pi">:</span> <span class="s2">"</span><span class="s">An</span><span class="nv"> </span><span class="s">example</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Amazon</span><span class="nv"> </span><span class="s">States</span><span class="nv"> </span><span class="s">Language</span><span class="nv"> </span><span class="s">using</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">choice</span><span class="nv"> </span><span class="s">state."</span>
        <span class="s">StartAt</span><span class="pi">:</span> <span class="s">FirstState</span>
        <span class="s">States</span><span class="pi">:</span>
          <span class="s">FirstState</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello1</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">ChoiceState</span>
          <span class="s">ChoiceState</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Choice</span>
            <span class="s">Choices</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Variable</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$.foo"</span>
              <span class="s">NumericEquals</span><span class="pi">:</span> <span class="s">1</span>
              <span class="s">Next</span><span class="pi">:</span> <span class="s">FirstMatchState</span>
            <span class="pi">-</span> <span class="s">Variable</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$.foo"</span>
              <span class="s">NumericEquals</span><span class="pi">:</span> <span class="s">2</span>
              <span class="s">Next</span><span class="pi">:</span> <span class="s">SecondMatchState</span>
            <span class="s">Default</span><span class="pi">:</span> <span class="s">DefaultState</span>
          <span class="s">FirstMatchState</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello2</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">NextState</span>
          <span class="s">SecondMatchState</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello3</span>
            <span class="s">Next</span><span class="pi">:</span> <span class="s">NextState</span>
          <span class="s">DefaultState</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Fail</span>
            <span class="s">Cause</span><span class="pi">:</span> <span class="s2">"</span><span class="s">No</span><span class="nv"> </span><span class="s">Matches!"</span>
          <span class="s">NextState</span><span class="pi">:</span>
            <span class="s">Type</span><span class="pi">:</span> <span class="s">Task</span>
            <span class="s">Resource</span><span class="pi">:</span> <span class="s">arn:aws:lambda:${opt:region}:${self:custom.accountId}:function:${self:service}-${opt:stage}-hello4</span>
            <span class="s">End</span><span class="pi">:</span> <span class="s">true</span>
</code></pre></div> </section> <footer class="cf w-100"> <div class="cover bg-left bg-center-l pv5" style="background-image: url(/img/bg.png)"> <form action="//tachyonstemplates.us16.list-manage.com/subscribe/post?u=3ff847fac68c99ba4cbf378be&amp;id=8eb026def6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="center pa3" target="_blank" novalidate> <div> <h3 class="pa0 f3 f2-ns mb3 mt0 white tc">Want more Serverless?</h3> <h5 class="pa0 f4 f3-ns mb3 white tc">Subscribe to our mailing list to receive an update when new items arrive!</h5> <div class="cf mw7 center"> <label class="clip" for="email-address">Email Address</label> <input placeholder="Your Email Address" type="email" name="EMAIL" class="f6 f5-l input-reset bn fl black-80 bg-white pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns"> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3ff847fac68c99ba4cbf378be_8eb026def6" tabindex="-1" value=""></div> <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-black-70 hover-bg-black white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" name="subscribe" type="submit" value="Subscribe"> </div> </div> </form> </div> <div class="pb4 pt2 ph3 ph5-ns tc lh-copy"> <a class="pv2 db ph3 dim" href="/">Serverless Directory - Plugins, Frameworks, Consultants</a> <a class="pv2 db ph3 dim" href="/frameworks/">Serverless Frameworks Directory</a> <a class="pv2 db ph3 dim" href="/plugins/">Serverless Plugin Directory</a> <a class="pv2 db ph3 dim" href="/plugins/topics/">Serverless Plugin Topics</a> </div> </footer> <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script> <!-- keeping this here for prosperity --> </body> </html>
