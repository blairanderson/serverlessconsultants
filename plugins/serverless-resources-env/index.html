<!DOCTYPE html> <html> <head> <script type="text/javascript"> var host = 'www.serverlessconsultants.com'; if (host == window.location.host && window.location.protocol != 'https:') { window.location.protocol = 'https'; } </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content="Serverless Directory"> <meta name="msvalidate.01" content="0C81C6A5BD3BAF86F4730D8C4A9BF223" /> <meta name="google-site-verification" content=""> <title>Serverless Resources Env - Serverless Plugin Directory</title> <!-- Google+ Authorship --> <link rel="author" href="Serverless Directory"> <link rel="publisher" href="Serverless Directory"> <!-- Canonical --> <link rel="canonical" href="https://www.serverlessconsultants.com/plugins/serverless-resources-env/"> <!-- Fonts --> <link href='https://fonts.googleapis.com/css?family=Libre+Franklin:400,100,100italic,200,200italic,300,300italic,400italic,500,600,500italic,600italic,700,700italic,800,900,800italic,900italic' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'> <!-- Styles --> <link rel="stylesheet" href=" /css/main.css "> <!-- Feed --> <link rel="alternate" type="application/rss+xml" title="ServerLess Directory" href="https://www.serverlessconsultants.com /feed.xml "> <!-- Fav Icon and Apple Touch Icons --> <link rel="icon" type="image/png" href="/img/favicon.png" sizes="128x128" /> <meta name="application-name" content="ServerLess Directory" /> <!-- Open Graph --> <meta property="og:title" content="Serverless Resources Env - Serverless Plugin Directory"> <meta property="og:site_name" content="ServerLess Directory"> <meta property="og:type" content="website"> <meta property="og:description" content="Open Issue Count: 4, Stargazer Count: 11, Forks Count: 5, Watchers Count: 11."> </head> <script type="text/javascript"> (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]); a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga('create', 'UA-61052500-12', 'auto'); ga('send', 'pageview'); </script> <body> <!-- Navigation --> <header class="bg-white w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-999 bb b--light-gray"> <nav class="tc"> <a class="dib no-underline v-mid tc bw1 ba b gold ph1 pv2 outline b--gold" href="/" rel="nofollow"> <div>SRVR</div> <div>LSS</div> </a> <a class="link dim black b f6 f5-ns dib mr3" href="/" title="Serverless Directory">Serverless Directory</a> <a class="link dim gray f6 f5-ns dib mr3" href="/plugins/">Serverless Plugins</a> <a class="link dim gray f6 f5-ns dib mr3" href="/frameworks/">Serverless Frameworks</a> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/consultants/">Serverless Consultants</a> --> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/contact" title="Contact Serverless Frameworks Directory">Contact</a> --> </nav> </header> <div class="mw8 center"> <h1 class="tc ma0">Serverless Resources Env</h1> <div class="tc"> <a rel="nofollow noreferrer noopener" href="https://github.com/rurri/serverless-resources-env"> <img src="https://icon.now.sh/home" alt="homepage icon"> https://github.com/rurri/serverless-resources-env </a> </div> <article class="ph3 ph5-ns"> <h3 class="f6 ma0 pa0 ttu tc tracked">Tracked</h3> <div class="cf tc"> <dl title="NPM Downloads Last Month: 293" class="db tc mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">NPM Downloads Last Month</dd> <dd class="f3 fw6 ml0">293</dd> </dl> <dl title="Open Issue Count: 4" class="fl fn-l w-50 mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Issues</dd> <dd class="f3 fw6 ml0">4</dd> </dl> <dl title="Stargazer Count: 11" class="fl fn-l w-50 dib-l mb0 w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Stars</dd> <dd class="f3 fw6 ml0">11</dd> </dl> <dl title="Forks Count: 5" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title mr5-l"> <dd class="f6 fw4 ml0">Forks</dd> <dd class="f3 fw6 ml0">5</dd> </dl> <dl title="Watchers Count: 11" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title"> <dd class="f6 fw4 ml0">Watchers</dd> <dd class="f3 fw6 ml0">11</dd> </dl> </div> </article> <!-- TODO: FIX THIS --> <div class="cf tc mw6 center dn"> </div> </div> <h3 class="tc">Repo README Contents:</h3> <section class="mw8 center ph3 pv2 overflow-x-scroll ba br3" id="readme-content"> <p><a href="https://travis-ci.org/rurri/serverless-resources-env"><img src="https://travis-ci.org/rurri/serverless-resources-env.svg?branch=master" alt="Build Status" /></a> <a href="https://coveralls.io/github/rurri/serverless-resources-env?branch=master"><img src="https://coveralls.io/repos/github/rurri/serverless-resources-env/badge.svg?branch=master" alt="Coverage Status" /></a> <a href="https://www.bithound.io/github/rurri/serverless-resources-env"><img src="https://www.bithound.io/github/rurri/serverless-resources-env/badges/score.svg" alt="bitHound Overall Score" /></a></p> <p>A serverless framework plugin so that your functions know how to use resources created by cloudformation.</p> <p>In short, whether you are running your function as a lambda, or locally on your machine, the physical name or ARN of each resource that was part of your CloudFormation template will be available as an environment variable keyed to its logical name prefixed with <code class="highlighter-rouge">CF_</code>.</p> <p>For lambdas running on AWS, this plugin will set environment variables on your functions within lambda using the <a href="https://aws.amazon.com/about-aws/whats-new/2016/11/aws-lambda-supports-environment-variables/">Lambda environment variable support</a>.</p> <p>For running functions locally, it will also create a local env file for use in reading in environment variables for a specific region-stage-function while running functions locally. These are by default stored in a directory named: <code class="highlighter-rouge">.serverless-resources-env</code> in files named <code class="highlighter-rouge">.&lt;region&gt;_&lt;stage&gt;_&lt;function-name&gt;</code>. Ex: <code class="highlighter-rouge">./.serverless-resources-env/.us-east-1_dev_hello</code>. These environment variables are set automatically by the plugin when running <code class="highlighter-rouge">serverless invoke local -f ...</code>.</p> <p><strong>Breaking Changes in 0.3.0:</strong> <em>See below</em></p> <h2 id="why">Why?</h2> <p>You have a CloudFormation template all set, and you are writing your functions. Now you are ready to use the resources created as part of your CF template. Well, you need to know about them! You could deploy and then try and manage configuration for these resources, or you can use this module which will automatically set environmet variables that map the logical resource name to the physical resource name for resources within the CloudFormation file.</p> <h2 id="example">Example:</h2> <p>You have defined resources in your serverless.yml called <code class="highlighter-rouge">mySQS</code> and <code class="highlighter-rouge">myTable</code>, and you want to actually use these in your function so you need their ARN or the actual table name that was created.</p> <div class="highlighter-rouge"><pre class="highlight"><code>const sqs_arn = process.env.CF_mySQS;
const my_dynamo_table_name = process.env.CF_myTable;
</code></pre></div> <h2 id="how-it-works">How it works</h2> <p>This plugin attaches to the deploy post-deploy hook. After the stack is deployed to AWS, the plugin determines the name of the cloud formation stack, and queries AWS for all resources in this stack.</p> <p>After deployment, this plugin, will fetch all the CF resources for the current stack (stage i.e. ‘dev’). It will then use the AWS SDK to set as environment variables the physical id’s of each resource as an environment variable prefixed with <code class="highlighter-rouge">CF_</code>.</p> <p>It will also create a file with these values in a .properties file format named <code class="highlighter-rouge">./serverless-resources-env/.&lt;region&gt;_&lt;stage&gt;_&lt;function-name&gt;</code>. These are then pulled in during a local invocation (<code class="highlighter-rouge">serverless invoke local -f...</code>) Each region, stage, and function will get its own file. When invoking locally the module will automatically select the correct .env information based on which region and stage is set.</p> <p>This means no code changes, or config changes no matter how many regions, and stages you deploy to.</p> <p>The lambdas always know exactly where to find their resources, whether that resource is a DynamoDB, SQS, SNS, or anything else.</p> <h2 id="install--setup">Install / Setup</h2> <p><code class="highlighter-rouge">npm install serverless-resources-env --save</code></p> <p>Add the plugin to the serverless.yml.</p> <div class="highlighter-rouge"><pre class="highlight"><code>plugins:
  - serverless-resources-env
</code></pre></div> <p>Set your resources as normal:</p> <div class="highlighter-rouge"><pre class="highlight"><code>resources:
  Resources:
    testTopic1:
      Type: AWS::SNS::Topic
    testTopic2:
      Type: AWS::SNS::Topic

</code></pre></div> <p>Set which resources you want exported on each function.</p> <div class="highlighter-rouge"><pre class="highlight"><code>functions:
  hello:
    handler: handler.hello
    custom:
      env-resources:
        - testTopic1
        - testTopic2
</code></pre></div> <h2 id="breaking-changes-since-020">Breaking Changes since 0.2.0</h2> <p>At version 0.2.0 and before, all resources were exported to both the local .env file and to each function automatically.</p> <p>This caused issues with AWS limits on the amount of information that could be exported as env variables onto lambdas deployed within AWS. This also exposed resources as env variables that were not needed by functions, as it was setting <em>all</em> resources, not just the ones the function needed.</p> <p>Starting at version 0.3.0 a list of which resources are to be exported to each function are required to be a part of the function definition in the .yml file, if the function needs any of these environment variables. (See current install instructions above)</p> <p>This also means that specific env files are needed per region / stage / function. This can potentially be a lot of files and therefore these files were also moved to a sub-folder. <code class="highlighter-rouge">.serverless-resources-env</code> by default.</p> <h2 id="common-errors">Common Errors</h2> <p><code class="highlighter-rouge">Unexpected key 'Environment' found in params</code>. Your aws-sdk is out of date. Setting environment variables on lambdas is new. See the Important note above.</p> <p>You may need to upgrade the version of the package <code class="highlighter-rouge">aws-sdk</code> being used by the serverless framework.</p> <p>In the 1.1.0 serverless framework, the <code class="highlighter-rouge">aws-sdk</code> is pegged at version 2.6.8 in the <code class="highlighter-rouge">npm-shrinkwrap.json</code> of serverless.</p> <p>If you have installed serverless locally as part of your project you can just upgrade the sdk. <code class="highlighter-rouge">npm upgrade aws-sdk</code>.</p> <p>If you have installed serverless globally, you will need to change to the serverless directory and run <code class="highlighter-rouge">npm upgrade aws-sdk</code> from there.</p> <p>The following commands should get it done:</p> <div class="highlighter-rouge"><pre class="highlight"><code>cd `npm list serverless -g | head -n 1`/node_modules/serverless
npm upgrade aws-sdk
</code></pre></div> <h2 id="config">Config</h2> <p>By default, the mapping is written to a .env file located at <code class="highlighter-rouge">./.serverless-resources-env/.&lt;region&gt;_&lt;stage-name&gt;_env</code>. This can be overridden by setting an option in serverless.yml.</p> <div class="highlighter-rouge"><pre class="highlight"><code>custom:
  resource-output-dir: .alt-resource-dir
</code></pre></div> <div class="highlighter-rouge"><pre class="highlight"><code>functions:
  hello:
    custom:
      resource-output-file: .alt-file-name
</code></pre></div> </section> <footer class="cf w-100"> <div class="cover bg-left bg-center-l pv5" style="background-image: url(/img/bg.png)"> <form action="//tachyonstemplates.us16.list-manage.com/subscribe/post?u=3ff847fac68c99ba4cbf378be&amp;id=8eb026def6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="center pa3" target="_blank" novalidate> <div> <h3 class="pa0 f3 f2-ns mb3 mt0 white tc">Want more Serverless?</h3> <h5 class="pa0 f4 f3-ns mb3 white tc">Subscribe to our mailing list to receive an update when new items arrive!</h5> <div class="cf mw7 center"> <label class="clip" for="email-address">Email Address</label> <input placeholder="Your Email Address" type="email" name="EMAIL" class="f6 f5-l input-reset bn fl black-80 bg-white pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns"> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3ff847fac68c99ba4cbf378be_8eb026def6" tabindex="-1" value=""></div> <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-black-70 hover-bg-black white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" name="subscribe" type="submit" value="Subscribe"> </div> </div> </form> </div> <div class="pb4 pt2 ph3 ph5-ns tc lh-copy"> <a class="pv2 db ph3 dim" href="/">Serverless Directory - Plugins, Frameworks, Consultants</a> <a class="pv2 db ph3 dim" href="/frameworks/">Serverless Frameworks Directory</a> <a class="pv2 db ph3 dim" href="/plugins/">Serverless Plugin Directory</a> <a class="pv2 db ph3 dim" href="/plugins/topics/">Serverless Plugin Topics</a> </div> </footer> <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script> <!-- keeping this here for prosperity --> </body> </html>
