<!DOCTYPE html> <html> <head> <script type="text/javascript"> var host = 'www.serverlessconsultants.com'; if (host == window.location.host && window.location.protocol != 'https:') { window.location.protocol = 'https'; } </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content="Serverless Directory"> <meta name="msvalidate.01" content="0C81C6A5BD3BAF86F4730D8C4A9BF223" /> <meta name="google-site-verification" content=""> <title>Serverless Env Generator - Serverless Plugin Directory</title> <!-- Google+ Authorship --> <link rel="author" href="Serverless Directory"> <link rel="publisher" href="Serverless Directory"> <!-- Canonical --> <link rel="canonical" href="https://www.serverlessconsultants.com/plugins/serverless-env-generator/"> <!-- Fonts --> <link href='https://fonts.googleapis.com/css?family=Libre+Franklin:400,100,100italic,200,200italic,300,300italic,400italic,500,600,500italic,600italic,700,700italic,800,900,800italic,900italic' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'> <!-- Styles --> <link rel="stylesheet" href=" /css/main.css "> <!-- Feed --> <link rel="alternate" type="application/rss+xml" title="ServerLess Directory" href="https://www.serverlessconsultants.com /feed.xml "> <!-- Fav Icon and Apple Touch Icons --> <link rel="icon" type="image/png" href="/img/favicon.png" sizes="128x128" /> <meta name="application-name" content="ServerLess Directory" /> <!-- Open Graph --> <meta property="og:title" content="Serverless Env Generator - Serverless Plugin Directory"> <meta property="og:site_name" content="ServerLess Directory"> <meta property="og:type" content="website"> <meta property="og:description" content="Open Issue Count: 2, Stargazer Count: 11, Forks Count: 2, Watchers Count: 11."> </head> <script type="text/javascript"> (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]); a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga('create', 'UA-61052500-12', 'auto'); ga('send', 'pageview'); </script> <body> <!-- Navigation --> <header class="bg-white w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-999 bb b--light-gray"> <nav class="tc"> <a class="dib no-underline v-mid tc bw1 ba b gold ph1 pv2 outline b--gold" href="/" rel="nofollow"> <div>SRVR</div> <div>LSS</div> </a> <a class="link dim black b f6 f5-ns dib mr3" href="/" title="Serverless Directory">Serverless Directory</a> <a class="link dim gray f6 f5-ns dib mr3" href="/plugins/">Serverless Plugins</a> <a class="link dim gray f6 f5-ns dib mr3" href="/frameworks/">Serverless Frameworks</a> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/consultants/">Serverless Consultants</a> --> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/contact" title="Contact Serverless Frameworks Directory">Contact</a> --> </nav> </header> <div class="mw8 center"> <h1 class="tc ma0">Serverless Env Generator</h1> <div class="tc"> <a rel="nofollow noreferrer noopener" href="https://github.com/DieProduktMacher/serverless-env-generator"> <img src="https://icon.now.sh/home" alt="homepage icon"> https://github.com/DieProduktMacher/serverless-env-generator </a> </div> <article class="ph3 ph5-ns"> <h3 class="f6 ma0 pa0 ttu tc tracked">Tracked</h3> <div class="cf tc"> <dl title="NPM Downloads Last Month: 144" class="db tc mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">NPM Downloads Last Month</dd> <dd class="f3 fw6 ml0">144</dd> </dl> <dl title="Open Issue Count: 2" class="fl fn-l w-50 mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Issues</dd> <dd class="f3 fw6 ml0">2</dd> </dl> <dl title="Stargazer Count: 11" class="fl fn-l w-50 dib-l mb0 w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Stars</dd> <dd class="f3 fw6 ml0">11</dd> </dl> <dl title="Forks Count: 2" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title mr5-l"> <dd class="f6 fw4 ml0">Forks</dd> <dd class="f3 fw6 ml0">2</dd> </dl> <dl title="Watchers Count: 11" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title"> <dd class="f6 fw4 ml0">Watchers</dd> <dd class="f3 fw6 ml0">11</dd> </dl> </div> </article> <!-- TODO: FIX THIS --> <div class="cf tc mw6 center dn"> </div> </div> <h3 class="tc">Repo README Contents:</h3> <section class="mw8 center ph3 pv2 overflow-x-scroll ba br3" id="readme-content"> <h1 id="serverless-env-generator-plugin">Serverless Env Generator Plugin</h1> <p><a href="https://travis-ci.org/DieProduktMacher/serverless-env-generator"><img src="https://travis-ci.org/DieProduktMacher/serverless-env-generator.svg?branch=develop" alt="Build Status" /></a></p> <p>This plugin automatically creates a <em>.env</em> file during deployment by merging environment variables from one or more YAML files. During runtime these variables can then be loaded into <em>process.env</em> using <em>dotenv</em>.</p> <p>For a brief introduction, read our blogpost about <a href="http://www.dieproduktmacher.com/introducing-serverless-env-generator/">introducing serverless-env-generator</a>.</p> <h3 id="key-features">Key features:</h3> <ul> <li>Support for multi-stage configurations and custom profiles</li> <li>Value of environment variables can be encrypted with AWS KMS, allowing teams to manage sensitive information in git.</li> <li>By using KMS, access to secrets can be controlled with IAM. We recommend to create one KMS key per serverless-profile, so you can limit access to credentials to deployment privileges.</li> <li>During deployment a temporary .env file is created and uploaded to Lambda by merging and decrypting values of your environment YAML files.</li> <li>Environment variables can be loaded with <em>dotenv</em> at startup in Lambda without delays from KMS.</li> <li>Supports <em>serverless-local-dev-server</em> for local development.</li> </ul> <h3 id="notes">Notes</h3> <p>Please note that the uploaded <em>.env</em> file contains secrets in cleartext. Therefore we recommend to use <a href="https://github.com/marcy-terui/serverless-crypt">Serverless Crypt</a> for critical secrets. This tool aims to strike a balance between storing secrets in plaintext in Lambda environment variables and having to decrypt them at runtime using KMS.</p> <p>Furthermore the tool does not support environment variables generated by Serverless. We recommend to set these variables directly in each functions configuration in <em>serverless.yml</em>.</p> <p>When used with <em>serverless-local-dev-server</em> your environment variables are directly loaded into <em>process.env</em>. No <em>.env</em> file is created to make sure that your local development and deployment tasks do not interfere :-)</p> <p>This package requires node &gt;= 6.0. Due to the reliance on KMS, encryption is only supported for AWS.</p> <h1 id="table-of-contents">Table of Contents</h1> <ul> <li><a href="#markdown-header-getting-started">Getting Started</a></li> <li><a href="#markdown-header-commands">Commands</a></li> <li><a href="#markdown-header-yaml-file-structure">YAML File Structure</a></li> <li><a href="#markdown-header-usage-with-the-serverless-plugin-webpack">Usage with the serverless-plugin-webpack</a></li> </ul> <h1 id="getting-started">Getting Started</h1> <h3 id="1-install-the-plugin-and-dotenv">1. Install the plugin and dotenv</h3> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>npm install dotenv --save
npm install serverless-env-generator --save-dev
</code></pre></div> <h3 id="2-create-a-key-on-kms">2. Create a key on KMS</h3> <p>See: https://docs.aws.amazon.com/kms/latest/developerguide/create-keys.html</p> <p>Please make sure to create the KMS key in the same region as your deployment.</p> <p>For aliases we recommend to use the service name, for administration privileges no user (your AWS account has full permissions by default) and for usage privileges ‚Äúserverless-admin‚Äù to link access permissions to deployment permissions.</p> <h3 id="3-add-the-plugin-to-your-serverless-configuration-file">3. Add the plugin to your serverless configuration file</h3> <p><em>serverless.yml</em> configuration example:</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">provider</span><span class="pi">:</span>
  <span class="s">name</span><span class="pi">:</span> <span class="s">aws</span>
  <span class="s">runtime</span><span class="pi">:</span> <span class="s">nodejs6.10</span>

<span class="s">functions</span><span class="pi">:</span>
  <span class="s">hello</span><span class="pi">:</span>
    <span class="s">handler</span><span class="pi">:</span> <span class="s">handler.hello</span>

<span class="c1"># Add serverless-env-generator to your plugins:</span>
<span class="s">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-env-generator</span>

<span class="c1"># Plugin config goes into custom:</span>
<span class="s">custom</span><span class="pi">:</span>
  <span class="s">envFiles</span><span class="pi">:</span> <span class="c1">#YAML files used to create .env file</span>
    <span class="pi">-</span> <span class="s">environment.yml</span>
  <span class="s">envEncryptionKeyId</span><span class="pi">:</span> <span class="c1">#KMS Key used for encrypting values</span>
    <span class="s">dev</span><span class="pi">:</span> <span class="s">${env:AWS_KMS_KEYID}</span> <span class="c1">#Key used for development-stage</span>
</code></pre></div> <h3 id="4-add-the-env-file-to-your-gitignore">4. Add the .env file to your .gitignore</h3> <p>As the generated <em>.env</em> file contains the secrets in cleartext, make sure that it will never be checked into git!</p> <p><em>.gitignore</em> code example:</p> <div class="highlighter-rouge"><pre class="highlight"><code>.env
</code></pre></div> <h3 id="5-add-variables-to-your-environment-yaml-file">5. Add variables to your environment YAML file</h3> <p>Command example:</p> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>serverless env --attribute name --value <span class="s2">"This is not a secret"</span>
serverless env --attribute secret_name --value <span class="s2">"This is a secret"</span> --encrypt
</code></pre></div> <h3 id="6-write-your-function">6. Write your function</h3> <p>Note that the <em>.env</em> file is automatically created when you deploy your function, so you can just load those variables with dotenv üéâ</p> <p>Code example:</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">require</span><span class="p">(</span><span class="s1">'dotenv'</span><span class="p">).</span><span class="nx">config</span><span class="p">()</span> <span class="c1">// Load variables from .env file</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">hello</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">statusCode</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
      <span class="na">message</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">secret_name</span><span class="p">,</span>
      <span class="na">input</span><span class="p">:</span> <span class="nx">event</span>
    <span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div> <h3 id="7-deploy--test-your-function">7. Deploy &amp; test your function</h3> <p>Command example:</p> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>serverless deploy
serverless invoke -f <span class="nv">$FUNCTION_NAME</span>
</code></pre></div> <p>Result example:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{\"input\": {}, \"message\": \"This is a secret\"}"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> <h1 id="commands">Commands</h1> <p>You can use these commands to modify your YAML environment files.</p> <p>If no stage is specified the default one as specified in <em>serverless.yml</em> is used.</p> <h2 id="viewing-environment-variables">Viewing environment variables</h2> <p>Use the following commands to read and decrypt variables from your YAML environment files:</p> <h3 id="list-variables">List variables</h3> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>serverless env
serverless env --stage <span class="nv">$STAGE</span>
</code></pre></div> <h3 id="view-one-variable">View one variable</h3> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>serverless env --attribute <span class="nv">$NAME</span>
serverless env --attribute <span class="nv">$NAME</span> --stage <span class="nv">$STAGE</span>

<span class="c">#shorthand:</span>
sls env -a <span class="nv">$NAME</span>
sls env -a <span class="nv">$NAME</span> -s <span class="nv">$STAGE</span>
</code></pre></div> <h3 id="decrypt-variables">Decrypt variables</h3> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>serverless env --decrypt
serverless env --attribute <span class="nv">$NAME</span> --decrypt
serverless env --attribute <span class="nv">$NAME</span> --stage <span class="nv">$STAGE</span> --decrypt

<span class="c">#shorthand:</span>
sls env -a <span class="nv">$NAME</span> --decrypt
sls env -a <span class="nv">$NAME</span> -s <span class="nv">$STAGE</span> -d
</code></pre></div> <h2 id="setting-environment-variables">Setting environment variables</h2> <p>Use the following commands to store and encrypt variables in your YAML environment files:</p> <p>Note that variables are stored to the first file listed in <em>envFiles</em>.</p> <h3 id="set-a-variable">Set a variable</h3> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>serverless env --attribute <span class="nv">$NAME</span> --value <span class="nv">$PLAINTEXT</span>
serverless env --attribute <span class="nv">$NAME</span> --value <span class="nv">$PLAINTEXT</span> --stage <span class="nv">$STAGE</span>

<span class="c">#shorthand:</span>
sls env -a <span class="nv">$NAME</span> -v <span class="nv">$PLAINTEXT</span>
sls env --a <span class="nv">$NAME</span> -v <span class="nv">$PLAINTEXT</span> --s <span class="nv">$STAGE</span>
</code></pre></div> <h3 id="set-and-encrypt-a-variable">Set and encrypt a variable</h3> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>serverless env --attribute <span class="nv">$NAME</span> --value <span class="nv">$PLAINTEXT</span> --encrypt
serverless env --attribute <span class="nv">$NAME</span> --value <span class="nv">$PLAINTEXT</span> --stage <span class="nv">$STAGE</span> --encrypt

<span class="c">#shorthand:</span>
sls env -a <span class="nv">$NAME</span> -v <span class="nv">$PLAINTEXT</span> -e
sls env -a <span class="nv">$NAME</span> -v <span class="nv">$PLAINTEXT</span> -s <span class="nv">$STAGE</span> -e
</code></pre></div> <h1 id="yaml-file-structure">YAML File Structure</h1> <p>Environment variables are stored in stage-agnostic YAML files, which are then merged into a .env file on deployment.</p> <p>File example:</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">dev</span><span class="pi">:</span> <span class="c1">#stage</span>
    <span class="s">foo</span><span class="pi">:</span> <span class="s">bar</span> <span class="c1">#cleartext variable</span>
    <span class="s">bla</span><span class="pi">:</span> <span class="s">crypted:bc89hwnch8hncoaiwjnd...</span> <span class="c1">#encrypted variable</span>

<span class="s">production</span><span class="pi">:</span>
    <span class="s">foo</span><span class="pi">:</span> <span class="s">baz</span>
    <span class="s">bla</span><span class="pi">:</span> <span class="s">crypted:ncibinv0iwokncoiao3d...</span>
</code></pre></div> <p>You can create additional YAML environment files, for example to include variables that are dynamically generated. Just add them to the <em>envFiles</em> in your <em>serverless.yml</em>.</p> <h1 id="usage-with-the-serverless-plugin-webpack">Usage with the <code class="highlighter-rouge">serverless-plugin-webpack</code></h1> <p>In case you are also using the <a href="https://github.com/goldwasserexchange/serverless-plugin-webpack"><code class="highlighter-rouge">serverless-plugin-webpack</code></a> there are some caveats:</p> <h2 id="1-plugin-order-in-serverlessyml">1. Plugin order in `serverless.yml‚Äô</h2> <p>You have to place <code class="highlighter-rouge">serverless-env-generator</code> before the <code class="highlighter-rouge">serverless-plugin-webpack</code> in the <code class="highlighter-rouge">serverless.yml</code></p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="c1"># serverless.yml</span>
<span class="s">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-env-generator</span>
  <span class="pi">-</span> <span class="s">serverless-plugin-webpack</span>
</code></pre></div> <h2 id="2-additional-dotenv-webpack">2. Additional <code class="highlighter-rouge">dotenv-webpack</code></h2> <p>You need to have the <a href="https://github.com/mrsteele/dotenv-webpack"><code class="highlighter-rouge">dotenv-webpack</code></a> plugin installed:</p> <div class="language-sh highlighter-rouge"><pre class="highlight"><code>npm install dotenv-webpack --save-dev
</code></pre></div> <p>and configured:</p> <div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">// webpack.config.js</span>
<span class="kr">const</span> <span class="nx">Dotenv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'dotenv-webpack'</span><span class="p">)</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// ...</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="c1">// ...</span>
    <span class="k">new</span> <span class="nx">Dotenv</span><span class="p">()</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div> <h1 id="license--credits">License &amp; Credits</h1> <p>Licensed under the MIT license.</p> <p>Created and maintained by <a href="http://www.dieproduktmacher.com">DieProduktMacher</a>.</p> <p>Inspired by <a href="https://github.com/marcy-terui/serverless-crypt">Serverless Crypt</a>.</p> </section> <footer class="cf w-100"> <div class="cover bg-left bg-center-l pv5" style="background-image: url(/img/bg.png)"> <form action="//tachyonstemplates.us16.list-manage.com/subscribe/post?u=3ff847fac68c99ba4cbf378be&amp;id=8eb026def6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="center pa3" target="_blank" novalidate> <div> <h3 class="pa0 f3 f2-ns mb3 mt0 white tc">Want more Serverless?</h3> <h5 class="pa0 f4 f3-ns mb3 white tc">Subscribe to our mailing list to receive an update when new items arrive!</h5> <div class="cf mw7 center"> <label class="clip" for="email-address">Email Address</label> <input placeholder="Your Email Address" type="email" name="EMAIL" class="f6 f5-l input-reset bn fl black-80 bg-white pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns"> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3ff847fac68c99ba4cbf378be_8eb026def6" tabindex="-1" value=""></div> <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-black-70 hover-bg-black white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" name="subscribe" type="submit" value="Subscribe"> </div> </div> </form> </div> <div class="pb4 pt2 ph3 ph5-ns tc lh-copy"> <a class="pv2 db ph3 dim" href="/">Serverless Directory - Plugins, Frameworks, Consultants</a> <a class="pv2 db ph3 dim" href="/frameworks/">Serverless Frameworks Directory</a> <a class="pv2 db ph3 dim" href="/plugins/">Serverless Plugin Directory</a> <a class="pv2 db ph3 dim" href="/plugins/topics/">Serverless Plugin Topics</a> </div> </footer> <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script> <!-- keeping this here for prosperity --> </body> </html>
