<!DOCTYPE html> <html> <head> <script type="text/javascript"> var host = 'www.serverlessconsultants.com'; if (host == window.location.host && window.location.protocol != 'https:') { window.location.protocol = 'https'; } </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content="Serverless Directory"> <meta name="msvalidate.01" content="0C81C6A5BD3BAF86F4730D8C4A9BF223" /> <meta name="google-site-verification" content=""> <title>Serverless Export Env - Serverless Plugin Directory</title> <!-- Google+ Authorship --> <link rel="author" href="Serverless Directory"> <link rel="publisher" href="Serverless Directory"> <!-- Canonical --> <link rel="canonical" href="https://www.serverlessconsultants.com/plugins/serverless-export-env/"> <!-- Fonts --> <link href='https://fonts.googleapis.com/css?family=Libre+Franklin:400,100,100italic,200,200italic,300,300italic,400italic,500,600,500italic,600italic,700,700italic,800,900,800italic,900italic' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'> <!-- Styles --> <link rel="stylesheet" href=" /css/main.css "> <!-- Feed --> <link rel="alternate" type="application/rss+xml" title="ServerLess Directory" href="https://www.serverlessconsultants.com /feed.xml "> <!-- Fav Icon and Apple Touch Icons --> <link rel="icon" type="image/png" href="/img/favicon.png" sizes="128x128" /> <meta name="application-name" content="ServerLess Directory" /> <!-- Open Graph --> <meta property="og:title" content="Serverless Export Env - Serverless Plugin Directory"> <meta property="og:site_name" content="ServerLess Directory"> <meta property="og:type" content="website"> <meta property="og:description" content="Open Issue Count: 1, Stargazer Count: 5, Forks Count: 5, Watchers Count: 5."> </head> <script type="text/javascript"> (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]); a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga('create', 'UA-61052500-12', 'auto'); ga('send', 'pageview'); </script> <body> <!-- Navigation --> <header class="bg-white w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-999 bb b--light-gray"> <nav class="tc"> <a class="dib no-underline v-mid tc bw1 ba b gold ph1 pv2 outline b--gold" href="/" rel="nofollow"> <div>SRVR</div> <div>LSS</div> </a> <a class="link dim black b f6 f5-ns dib mr3" href="/" title="Serverless Directory">Serverless Directory</a> <a class="link dim gray f6 f5-ns dib mr3" href="/plugins/">Serverless Plugins</a> <a class="link dim gray f6 f5-ns dib mr3" href="/frameworks/">Serverless Frameworks</a> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/consultants/">Serverless Consultants</a> --> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/contact" title="Contact Serverless Frameworks Directory">Contact</a> --> </nav> </header> <div class="mw8 center"> <h1 class="tc ma0">Serverless Export Env</h1> <div class="tc"> <a rel="nofollow noreferrer noopener" href="https://github.com/arabold/serverless-export-env"> <img src="https://icon.now.sh/home" alt="homepage icon"> https://github.com/arabold/serverless-export-env </a> </div> <article class="ph3 ph5-ns"> <h3 class="f6 ma0 pa0 ttu tc tracked">Tracked</h3> <div class="cf tc"> <dl title="NPM Downloads Last Month: 174" class="db tc mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">NPM Downloads Last Month</dd> <dd class="f3 fw6 ml0">174</dd> </dl> <dl title="Open Issue Count: 1" class="fl fn-l w-50 mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Issues</dd> <dd class="f3 fw6 ml0">1</dd> </dl> <dl title="Stargazer Count: 5" class="fl fn-l w-50 dib-l mb0 w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Stars</dd> <dd class="f3 fw6 ml0">5</dd> </dl> <dl title="Forks Count: 5" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title mr5-l"> <dd class="f6 fw4 ml0">Forks</dd> <dd class="f3 fw6 ml0">5</dd> </dl> <dl title="Watchers Count: 5" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title"> <dd class="f6 fw4 ml0">Watchers</dd> <dd class="f3 fw6 ml0">5</dd> </dl> </div> </article> <!-- TODO: FIX THIS --> <div class="cf tc mw6 center dn"> </div> </div> <h3 class="tc">Repo README Contents:</h3> <section class="mw8 center ph3 pv2 overflow-x-scroll ba br3" id="readme-content"> <h1 id="️-serverless-export-env-plugin">⚡️ Serverless Export Env Plugin</h1> <p><a href="http://www.serverless.com"><img src="http://public.serverless.com/badges/v3.svg" alt="serverless" /></a> <a href="https://www.npmjs.com/package/serverless-export-env"><img src="https://img.shields.io/npm/v/serverless-export-env.svg" alt="npm" /></a> <a href="https://github.com/arabold/serverless-export-env/blob/master/LICENSE"><img src="https://img.shields.io/github/license/arabold/serverless-export-env.svg" alt="license" /></a> <a href="https://www.npmjs.com/package/serverless-export-env"><img src="https://img.shields.io/david/arabold/serverless-export-env.svg" alt="dependencies" /></a></p> <h2 id="about">About</h2> <p>This Serverless plugin exports the environment variables defined in <code class="highlighter-rouge">serverless.yml</code> into a distinct <code class="highlighter-rouge">.env</code> file. This allows you to access these environment variables from local scripts such as for integration tests. You will find the <code class="highlighter-rouge">.env</code> file in the root folder of your project.</p> <p>It will collect the global environment variables of the poject as well as all environment variables of the functions. It will also add <code class="highlighter-rouge">API_ENDPOINT</code> and <code class="highlighter-rouge">IS_OFFLINE</code> to your environment if you run the plugin via <code class="highlighter-rouge">serverless offline</code>.</p> <p>Environment variables referencing CloudFormation resources (e.g. <code class="highlighter-rouge">Ref: MyDynamoDbTable</code>), or import values (e.g. <code class="highlighter-rouge">Fn::ImportValue: MyExportedValue</code>) are automatically resolved to their respective values. This, however, requires the stack to be deployed before the plugin can access any of these variables.</p> <p>This plugin is based on the <a href="https://github.com/Jimdo/serverless-dotenv">serverless-dotenv Plugin by Jimdo</a> but largely rewritten to fit our needs.</p> <h2 id="why-another-plugin">Why another plugin?</h2> <p>There’re plenty of environment and dotenv plugins available for Serverless. However, some are already obsolete, others are very limited in use case. We needed a possibility to access Serverless environment variables from command line during integration testing of our code. As some of these environment variables are referencing CloudFormation resources, none of the existing plugins was able to solve this.</p> <h2 id="referencing-cloudformation-resources">Referencing CloudFormation resources</h2> <p>Serverless offers a very powerful feature: You are able to reference AWS resources anywhere from within your <code class="highlighter-rouge">.yaml</code> and it will automatically resolve them to their respective values during deployment. A common example is to bind a DynamoDB table name to an environment variable, so you can access it in your Lambda function implementation later:</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">provider</span><span class="pi">:</span>
  <span class="s">environment</span><span class="pi">:</span>
    <span class="s">TABLE_NAME</span><span class="pi">:</span>
      <span class="s">Ref</span><span class="pi">:</span> <span class="s">MyDynamoDbTable</span>
<span class="c1"># ...</span>
<span class="s">resources</span><span class="pi">:</span>
  <span class="s">Resources</span><span class="pi">:</span>
    <span class="s">MyDynamoDbTable</span><span class="pi">:</span>
      <span class="s">Type</span><span class="pi">:</span> <span class="s">AWS::DynamoDB::Table</span>
      <span class="s">DeletionPolicy</span><span class="pi">:</span> <span class="s">Retain</span>
      <span class="s">Properties</span><span class="pi">:</span>
        <span class="c1"># ...</span>
</code></pre></div> <p>Later in your code you can simply access <code class="highlighter-rouge">process.env.TABLE_NAME</code> to get the proper DynamoDB table name without having to hardcode anything.</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">require</span><span class="p">(</span><span class="s2">"dotenv"</span><span class="p">).</span><span class="nx">config</span><span class="p">({</span> <span class="na">path</span><span class="p">:</span> <span class="s2">"../.env"</span> <span class="cm">/* path to your project root folder */</span> <span class="p">});</span>

<span class="kr">const</span> <span class="nx">AWS</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'aws-sdk'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">docClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AWS</span><span class="p">.</span><span class="nx">DynamoDB</span><span class="p">.</span><span class="nx">DocumentClient</span><span class="p">({</span> <span class="cm">/* ... */</span> <span class="p">});</span>
<span class="nx">docClient</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span>
	<span class="na">TableName</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TABLE_NAME</span><span class="p">,</span>
	<span class="na">Key</span><span class="p">:</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="s2">"bar"</span> <span class="p">}</span>
<span class="p">},</span> <span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div> <p>The <em>Serverless Export Env Plugin</em> supports references to resources created within the <code class="highlighter-rouge">serverless.yml</code>, to resources imported from another stack via <code class="highlighter-rouge">Fn::ImportValue</code>, pseudo parameters such as <code class="highlighter-rouge">AWS::Region</code> and <code class="highlighter-rouge">AWS::AccountId</code> as well as the commonly used <code class="highlighter-rouge">Fn::Join</code> intrinsic function.</p> <p>The plugin allows you to make use of these references (and all other environment variables of course) from the command line by exporting them into a <code class="highlighter-rouge">.env</code> file in your project folder. Then use a library such as <a href="https://www.npmjs.com/package/dotenv">dotenv</a> to read them during runtime.</p> <h2 id="usage">Usage</h2> <p>Add the npm package to your project:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c"># Via yarn</span>
<span class="gp">$ </span>yarn add arabold/serverless-export-env --dev

<span class="c"># Via npm</span>
<span class="gp">$ </span>npm install arabold/serverless-export-env --save-dev
</code></pre></div> <p>Add the plugin to your <code class="highlighter-rouge">serverless.yml</code>:</p> <div class="language-yaml highlighter-rouge"><pre class="highlight"><code><span class="s">plugins</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">serverless-export-env</span>
</code></pre></div> <p>That’s it! You can now call <code class="highlighter-rouge">serverless export-env</code> in your terminal to generate the <code class="highlighter-rouge">.env</code> file based on your Serverless configuration. Alternative you can just start <code class="highlighter-rouge">serverless invoke local -f FUNCTION</code> or <code class="highlighter-rouge">serverless offline</code> to generate it.</p> <h2 id="provided-lifecycle-events">Provided lifecycle events</h2> <ul> <li><code class="highlighter-rouge">export-env:collect</code> - Collect environment variables from Serverless</li> <li><code class="highlighter-rouge">export-env:resolve</code> - Resolve CloudFormation references and import variables</li> <li><code class="highlighter-rouge">export-env:apply</code> - Set environment variables when testing Lambda functions locally</li> <li><code class="highlighter-rouge">export-env:write</code> - Write environment variables to file</li> </ul> <h2 id="example">Example</h2> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>serverless <span class="nb">export</span>-env
</code></pre></div> <p>This example will export all environment variables into a <code class="highlighter-rouge">.env</code> file in your project root folder.</p> <h2 id="releases">Releases</h2> <h3 id="112">1.1.2</h3> <ul> <li>Fixed an issue with CloudFormation resources not being resolved properly if the stack has more than 100 resources or exports.</li> </ul> <h3 id="111">1.1.1</h3> <ul> <li>Fix issue with multiple environment variables for function (thanks to <a href="https://github.com/Nevon">@Nevon</a>).</li> </ul> <h3 id="110">1.1.0</h3> <ul> <li>Support <code class="highlighter-rouge">Fn::Join</code> operation (contribution by <a href="https://github.com/jonasho">@jonasho</a>)</li> <li>Support pseudo parameters <code class="highlighter-rouge">AWS::Region</code>, <code class="highlighter-rouge">AWS::AccountId</code>, <code class="highlighter-rouge">AWS::StackId</code> and <code class="highlighter-rouge">AWS::StackName</code>.</li> </ul> <h3 id="102">1.0.2</h3> <ul> <li>The plugin now properly resolves and sets the environment variables if a Lambda function is invoked locally (<code class="highlighter-rouge">serverless invoke local -f FUNCTION</code>). This allows seamless as if the function would be deployed on AWS.</li> </ul> <h3 id="101">1.0.1</h3> <ul> <li>Corrected plugin naming</li> <li>Improved documentation</li> </ul> <h3 id="100">1.0.0</h3> <ul> <li>This is the initial release with all basic functionality</li> </ul> <h3 id="to-dos">To-Dos</h3> <ul> <li>[ ] Add support for more intrinsic functions such as <code class="highlighter-rouge">Fn::GetAtt</code>, <code class="highlighter-rouge">Fn::Sub</code>, etc. (see http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference.html)</li> <li>[ ] Write some tests!</li> </ul> </section> <footer class="cf w-100"> <div class="cover bg-left bg-center-l pv5" style="background-image: url(/img/bg.png)"> <form action="//tachyonstemplates.us16.list-manage.com/subscribe/post?u=3ff847fac68c99ba4cbf378be&amp;id=8eb026def6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="center pa3" target="_blank" novalidate> <div> <h3 class="pa0 f3 f2-ns mb3 mt0 white tc">Want more Serverless?</h3> <h5 class="pa0 f4 f3-ns mb3 white tc">Subscribe to our mailing list to receive an update when new items arrive!</h5> <div class="cf mw7 center"> <label class="clip" for="email-address">Email Address</label> <input placeholder="Your Email Address" type="email" name="EMAIL" class="f6 f5-l input-reset bn fl black-80 bg-white pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns"> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3ff847fac68c99ba4cbf378be_8eb026def6" tabindex="-1" value=""></div> <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-black-70 hover-bg-black white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" name="subscribe" type="submit" value="Subscribe"> </div> </div> </form> </div> <div class="pb4 pt2 ph3 ph5-ns tc lh-copy"> <a class="pv2 db ph3 dim" href="/">Serverless Directory - Plugins, Frameworks, Consultants</a> <a class="pv2 db ph3 dim" href="/frameworks/">Serverless Frameworks Directory</a> <a class="pv2 db ph3 dim" href="/plugins/">Serverless Plugin Directory</a> <a class="pv2 db ph3 dim" href="/plugins/topics/">Serverless Plugin Topics</a> </div> </footer> <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script> <!-- keeping this here for prosperity --> </body> </html>
