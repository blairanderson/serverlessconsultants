<!DOCTYPE html> <html> <head> <script type="text/javascript"> var host = 'www.serverlessconsultants.com'; if (host == window.location.host && window.location.protocol != 'https:') { window.location.protocol = 'https'; } </script> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content=""> <meta name="author" content="Serverless Directory"> <meta name="msvalidate.01" content="0C81C6A5BD3BAF86F4730D8C4A9BF223" /> <meta name="google-site-verification" content=""> <title>Serverless Plugin Lambda Dead Letter - Serverless Plugin Directory</title> <!-- Google+ Authorship --> <link rel="author" href="Serverless Directory"> <link rel="publisher" href="Serverless Directory"> <!-- Canonical --> <link rel="canonical" href="https://www.serverlessconsultants.com/plugins/serverless-plugin-lambda-dead-letter/"> <!-- Fonts --> <link href='https://fonts.googleapis.com/css?family=Libre+Franklin:400,100,100italic,200,200italic,300,300italic,400italic,500,600,500italic,600italic,700,700italic,800,900,800italic,900italic' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=PT+Sans+Caption:400,700' rel='stylesheet' type='text/css'> <link href='https://fonts.googleapis.com/css?family=Patrick+Hand+SC' rel='stylesheet' type='text/css'> <!-- Styles --> <link rel="stylesheet" href=" /css/main.css "> <!-- Feed --> <link rel="alternate" type="application/rss+xml" title="ServerLess Directory" href="https://www.serverlessconsultants.com /feed.xml "> <!-- Fav Icon and Apple Touch Icons --> <link rel="icon" type="image/png" href="/img/favicon.png" sizes="128x128" /> <meta name="application-name" content="ServerLess Directory" /> <!-- Open Graph --> <meta property="og:title" content="Serverless Plugin Lambda Dead Letter - Serverless Plugin Directory"> <meta property="og:site_name" content="ServerLess Directory"> <meta property="og:type" content="website"> <meta property="og:description" content="Open Issue Count: 4, Stargazer Count: 11, Forks Count: 1, Watchers Count: 11."> </head> <script type="text/javascript"> (function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; (i[r] = i[r] || function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * new Date()); (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]); a.async = 1; a.src = g; m.parentNode.insertBefore(a, m); })( window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga' ); ga('create', 'UA-61052500-12', 'auto'); ga('send', 'pageview'); </script> <body> <!-- Navigation --> <header class="bg-white w-100 ph3 pv3 pv4-ns ph4-m ph5-l z-999 bb b--light-gray"> <nav class="tc"> <a class="dib no-underline v-mid tc bw1 ba b gold ph1 pv2 outline b--gold" href="/" rel="nofollow"> <div>SRVR</div> <div>LSS</div> </a> <a class="link dim black b f6 f5-ns dib mr3" href="/" title="Serverless Directory">Serverless Directory</a> <a class="link dim gray f6 f5-ns dib mr3" href="/plugins/">Serverless Plugins</a> <a class="link dim gray f6 f5-ns dib mr3" href="/frameworks/">Serverless Frameworks</a> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/consultants/">Serverless Consultants</a> --> <!-- <a class="link dim gray f6 f5-ns dib mr3" href="/contact" title="Contact Serverless Frameworks Directory">Contact</a> --> </nav> </header> <div class="mw8 center"> <h1 class="tc ma0">Serverless Plugin Lambda Dead Letter</h1> <div class="tc"> <a rel="nofollow noreferrer noopener" href="https://github.com/gmetzker/serverless-plugin-lambda-dead-letter"> <img src="https://icon.now.sh/home" alt="homepage icon"> https://github.com/gmetzker/serverless-plugin-lambda-dead-letter </a> </div> <article class="ph3 ph5-ns"> <h3 class="f6 ma0 pa0 ttu tc tracked">Tracked</h3> <div class="cf tc"> <dl title="NPM Downloads Last Month: 4176" class="db tc mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">NPM Downloads Last Month</dd> <dd class="f3 fw6 ml0">4176</dd> </dl> <dl title="Open Issue Count: 4" class="fl fn-l w-50 mb0 dib-l w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Issues</dd> <dd class="f3 fw6 ml0">4</dd> </dl> <dl title="Stargazer Count: 11" class="fl fn-l w-50 dib-l mb0 w-auto-l lh-title mr5-l"> <dd class="f6 fw4 ml0">Stars</dd> <dd class="f3 fw6 ml0">11</dd> </dl> <dl title="Forks Count: 1" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title mr5-l"> <dd class="f6 fw4 ml0">Forks</dd> <dd class="f3 fw6 ml0">1</dd> </dl> <dl title="Watchers Count: 11" class="fl fn-l w-50 dib-l w-auto-l mb0 lh-title"> <dd class="f6 fw4 ml0">Watchers</dd> <dd class="f3 fw6 ml0">11</dd> </dl> </div> </article> <!-- TODO: FIX THIS --> <div class="cf tc mw6 center dn"> </div> </div> <h3 class="tc">Repo README Contents:</h3> <section class="mw8 center ph3 pv2 overflow-x-scroll ba br3" id="readme-content"> <h1 id="serverless-plugin--lambda-deadletterconfig">Serverless Plugin: Lambda DeadLetterConfig</h1> <p><a href="http://www.serverless.com"><img src="http://public.serverless.com/badges/v3.svg" alt="serverless" /></a> <a href="https://www.npmjs.com/package/serverless-plugin-lambda-dead-letter"><img src="https://img.shields.io/npm/v/serverless-plugin-lambda-dead-letter.svg" alt="npm version" /></a></p> <p><a href="https://travis-ci.org/gmetzker/serverless-plugin-lambda-dead-letter"><img src="https://travis-ci.org/gmetzker/serverless-plugin-lambda-dead-letter.svg?branch=master" alt="Build Status" /></a> <a href="https://coveralls.io/github/gmetzker/serverless-plugin-lambda-dead-letter?branch=master"><img src="https://coveralls.io/repos/github/gmetzker/serverless-plugin-lambda-dead-letter/badge.svg?branch=master" alt="Coverage Status" /></a> <a href="https://david-dm.org/gmetzker/serverless-plugin-lambda-dead-letter"><img src="https://img.shields.io/david/gmetzker/serverless-plugin-lambda-dead-letter.svg" alt="dependencies Status" /></a> <a href="https://david-dm.org/gmetzker/serverless-plugin-lambda-dead-letter?type=dev"><img src="https://img.shields.io/david/dev/gmetzker/serverless-plugin-lambda-dead-letter.svg" alt="devDependencies Status" /></a></p> <h2 id="what-is-it">What is it?</h2> <p>A <a href="https://serverless.com/">serverless</a> plugin that can assign a <code class="highlighter-rouge">DeadLetterConfig</code> to a Lambda function and optionally create a new SQS queue or SNS Topic with a simple syntax.</p> <p>Failed asynchronous messages for Amazon Lambda can be be sent to an SQS queue or an SNS topic by setting the <code class="highlighter-rouge">DeadLetterConfig</code>. Lambda Dead Letter Queues <a href="http://docs.aws.amazon.com/lambda/latest/dg/dlq.html">are documented here</a>.</p> <p>At the time this plugin was developed AWS Cloudformation (and serverless) did not support the <code class="highlighter-rouge">DeadLetterConfig</code> property of the Lambda so we have introduced a plugin that calls <code class="highlighter-rouge">UpdateFunctionConfiguration</code> on the lambda after serverless deploys the CloudFormation stack.</p> <h2 id="installation">Installation</h2> <h3 id="requirements">Requirements</h3> <ul> <li>nodeJs &gt; <code class="highlighter-rouge">v4.0</code></li> <li>serverless &gt; <code class="highlighter-rouge">v1.4</code></li> </ul> <p>Install the plugin.</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>npm install serverless-plugin-lambda-dead-letter
</code></pre></div> <p>Install the plugin with npm and reference it in the serverless yaml file <a href="https://serverless.com/framework/docs/providers/aws/guide/plugins/">as documented here.</a></p><pre><code class="language-YAML"># serverless.yml file

plugins:
  - serverless-plugin-lambda-dead-letter
</code></pre><h2 id="how-do-i-use-it">How do I use it?</h2> <p>Dead letter settings are assigned via a new <code class="highlighter-rouge">deadLetter</code> property nested under a function in a <code class="highlighter-rouge">serverless.yml</code> file.</p> <p>There are several methods to configure the Lambda deadLetterConfig.</p> <ul> <li><a href="#method-1">Method-1</a>: Create a new deadLetter SQS queue or SNS Topic</li> <li><a href="#method-2">Method-2</a>: Use a pre-existing queue/topic.</li> <li><a href="#method-3">Method-3</a>: Use a queue/topic created in the resources.</li> <li><a href="#remove-deadletter-resource">Remove Dead Letter Resource</a>: Remove any deadletter queue/topic that was previously assigned.</li> </ul> <h3 id="method-1">Method-1</h3> <h4 id="deadletter-queue">DeadLetter Queue</h4> <p>Use the <code class="highlighter-rouge">deadLetter.sqs</code> to create a new dead letter queue for the function.</p> <p>The resulting cloudformation stack will contain an SQS Queue and itâ€™s respective QueuePolicy.</p> <h4 id="create-new-dead-letter-queue-by-name">Create new dead-letter queue by name</h4><pre><code class="language-YAML"># 'functions' in serverless.yml

functions:
  createUser: # Function name
    handler: handler.createUser # Reference to function 'createUser' in code

    deadLetter:
      sqs:  createUser-dl-queue  # New Queue with this name
</code></pre><h4 id="create-new-dead-letter-queue-with-properties">Create new dead-letter queue with properties</h4><pre><code class="language-YAML"># 'functions' in serverless.yml

functions:
  createUser: # Function name
    handler: handler.createUser # Reference to function 'createUser' in code

    deadLetter:
      sqs:      # New Queue with these properties
        queueName: createUser-dl-queue
        delaySeconds: 60
        maximumMessageSize: 2048
        messageRetentionPeriod: 200000
        receiveMessageWaitTimeSeconds: 15
        visibilityTimeout: 300
</code></pre><h4 id="deadletter-topic">DeadLetter Topic</h4> <p>Use the <code class="highlighter-rouge">deadLetter.sns</code> to create a new dead letter topic for the function.</p> <p>The resulting cloudformation stack will contain an SQS Topic resource.</p><pre><code class="language-YAML"># 'functions' in serverless.yml

functions:
  createUser: # Function name
    handler: handler.createUser # Reference to function 'createUser' in code

    deadLetter:
      sns:  createUser-dl-topic
</code></pre><h3 id="method-2">Method-2</h3> <p>Use the <code class="highlighter-rouge">targetArn</code> property to specify the exact SQS queue or SNS topic to use for Lambda dead letter messages. In this case the queue\topic must already exist as must the queue\topic policy.</p> <p>Reference the ARN of an existing queue <code class="highlighter-rouge">createUser-dl-queue</code></p><pre><code class="language-YAML"># 'functions' in serverless.yml

functions:
  createUser: # Function name
    handler: handler.createUser # Reference to function 'createUser' in code

    deadLetter:
      targetArn: arn:aws:sqs:us-west-2:123456789012:createUser-dl-queue
</code></pre><h3 id="method-3">Method-3</h3> <p>If you created a queue\topic in the <code class="highlighter-rouge">resource</code> section you can reference it using the <code class="highlighter-rouge">GetResourceArn</code> pseudo method.</p> <p>This will use the arn of the resource referenced by <code class="highlighter-rouge"><span class="p">{</span><span class="err">logicalId</span><span class="p">}</span></code></p><pre><code class="language-YAML">    deadLetter:
      targetArn:
        GetResourceArn: {logicalId}
</code></pre><p>Note:</p> <ul> <li>At present this only works for SQS queues or SNS Topics.</li> <li>If a queue\topic is created in the <code class="highlighter-rouge">resources</code> section you will still need to add a resource for the respective queue\topic policy so that that lambda has permissions to write to the dead letter queue\topic.</li> </ul> <p>In this example the <code class="highlighter-rouge">createUser</code> lambda function is using the new <code class="highlighter-rouge">CreateUserDeadLetterQueue</code> SQS queue defined in the resources section.</p><pre><code class="language-YAML"># 'functions' in serverless.yml

functions:
  createUser: # Function name

    handler: handler.createUser # Reference to function 'createUser' in code

    # ...

    deadLetter:
      targetArn:
        GetResourceArn: CreateUserDeadLetterQueue

resources:
    Resources:
      CreateUserDeadLetterQueue:
        Type: AWS::SQS::Queue
        Properties:
          QueueName: create-user-lambda-dl-queue

      CreateUserDeadLetterQueuePolicy:
        Type: AWS::SQS::QueuePolicy
        Properties:
          Queues:
            - Ref: CreateUserDeadLetterQueue

            # Policy properties abbreviated but you need more here ...
</code></pre><h3 id="remove-deadletter-resource">Remove DeadLetter Resource</h3> <p>If you previously had a DeadLetter target and want to remove it such that there is no dead letter queue or topic you can supply the <code class="highlighter-rouge">deadLetter</code> object with an empty <code class="highlighter-rouge">targetArn</code>. Upon deploy the plugin will run the Lambda <code class="highlighter-rouge">UpdateFunctionConfiguration</code> and set an empty TargetArn.</p><pre><code class="language-YAML"># 'functions' in serverless.yml

functions:
  createUser: # Function name

    handler: handler.createUser # Reference to function 'createUser' in code

    # ...

    # Set an empty targetArn to erase previous DLQ settings.
    deadLetter:
      targetArn:
</code></pre></section> <footer class="cf w-100"> <div class="cover bg-left bg-center-l pv5" style="background-image: url(/img/bg.png)"> <form action="//tachyonstemplates.us16.list-manage.com/subscribe/post?u=3ff847fac68c99ba4cbf378be&amp;id=8eb026def6" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="center pa3" target="_blank" novalidate> <div> <h3 class="pa0 f3 f2-ns mb3 mt0 white tc">Want more Serverless?</h3> <h5 class="pa0 f4 f3-ns mb3 white tc">Subscribe to our mailing list to receive an update when new items arrive!</h5> <div class="cf mw7 center"> <label class="clip" for="email-address">Email Address</label> <input placeholder="Your Email Address" type="email" name="EMAIL" class="f6 f5-l input-reset bn fl black-80 bg-white pa3 lh-solid w-100 w-75-m w-80-l br2-ns br--left-ns"> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_3ff847fac68c99ba4cbf378be_8eb026def6" tabindex="-1" value=""></div> <input class="f6 f5-l button-reset fl pv3 tc bn bg-animate bg-black-70 hover-bg-black white pointer w-100 w-25-m w-20-l br2-ns br--right-ns" name="subscribe" type="submit" value="Subscribe"> </div> </div> </form> </div> <div class="pb4 pt2 ph3 ph5-ns tc lh-copy"> <a class="pv2 db ph3 dim" href="/">Serverless Directory - Plugins, Frameworks, Consultants</a> <a class="pv2 db ph3 dim" href="/frameworks/">Serverless Frameworks Directory</a> <a class="pv2 db ph3 dim" href="/plugins/">Serverless Plugin Directory</a> <a class="pv2 db ph3 dim" href="/plugins/topics/">Serverless Plugin Topics</a> </div> </footer> <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script> <!-- keeping this here for prosperity --> </body> </html>
